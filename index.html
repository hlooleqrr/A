<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± â€“ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„</title>
<style>
body{font-family:'Tajawal',sans-serif;background:#f4f6f8;margin:0;text-align:center}
header{background:#005c48;color:#fff;padding:24px 10px}
.container{max-width:600px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1)}
input,select,button{width:90%;padding:10px;margin:10px 0;font-size:16px;border-radius:5px;border:1px solid #ccc}
button{background:#00796b;color:#fff;border:none;cursor:pointer}
button:hover{background:#004d40}
footer{font-size:12px;color:#666;margin-top:40px;padding:10px}
.fade-in{opacity:0;transform:translateY(20px);animation:fadeIn .5s forwards}
@keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
</style>
</head>

<body>
<header>
  <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</p>
</header>

<div class="container" id="form">
  <button id="startBtn" onclick="start()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
  <div id="question"></div>
</div>

<!-- ================ JavaScript ================ -->
<script>
let answers={},commitments=[],curCommit={};

/* Ø£Ø¯ÙˆØ§Øª */
function show(h){document.getElementById('question').innerHTML='<div class="fade-in">'+h+'</div>';}
function start(){document.getElementById('startBtn').innerText='Ø£Ø¹Ø¯ Ø§Ù„Ø­Ø³Ø¨Ø©';answers={};commitments=[];askFinanceType();}

/* Ø§Ù„Ø£Ø³Ø¦Ù„Ø© */
function askFinanceType(){show(`<label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„:</label><br>
<select id="ft"><option>ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option><option>ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ</option></select><br>
<button onclick="saveFinanceType()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveFinanceType(){answers.financeType=document.getElementById('ft').value;(answers.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ')?askSupport():askSalary();}
function askSupport(){show(`<label>Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ</label><br>
<select id="sup"><option>Ù…Ø¯Ø¹ÙˆÙ…</option><option>ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…</option></select><br>
<button onclick="saveSupport()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveSupport(){answers.supported=document.getElementById('sup').value;(answers.supported==='Ù…Ø¯Ø¹ÙˆÙ…')?askBundle():askSalary();}
function askBundle(){show(`<label>Ù‡Ù„ ØªØ±ØºØ¨ Ø¨Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù‘Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ</label><br>
<select id="bun"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
<button onclick="saveBundle()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveBundle(){answers.bundle=document.getElementById('bun').value;askSalary();}
function askSalary(){show(`<label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±ÙŠÙ€Ø§Ù„):</label><br>
<input type="number" id="sal"><br><button onclick="saveSalary()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveSalary(){answers.salary=parseFloat(document.getElementById('sal').value)||0;askProfit();}
function askProfit(){show(`<label>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%):</label><br>
<input type="number" id="pr"><br><button onclick="saveProfit()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveProfit(){answers.profitMargin=parseFloat(document.getElementById('pr').value)||0;askDuration();}
function askDuration(){
  const max=answers.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'?60:360;
  const def=answers.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'?60:240;
  show(`<label>Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø£Ø´Ù‡Ø±):</label><br>
  <input type="range" id="dur" min="12" max="${max}" value="${def}" oninput="dVal.innerText=this.value">
  <br><span id="dVal">${def}</span> Ø´Ù‡Ø±<br><button onclick="saveDuration()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveDuration(){answers.duration=parseInt(document.getElementById('dur').value);askHasCommit();}
function askHasCommit(){show(`<label>Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ</label><br>
<select id="has"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
<button onclick="saveHasCommit()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveHasCommit(){document.getElementById('has').value==='Ù†Ø¹Ù…'?askCommitType():calculate();}

/* Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª */
function askCommitType(){show(`<label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…:</label><br>
<select id="ctype"><option>Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ</option><option>Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©</option><option>Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</option></select><br>
<button onclick="saveCommitType()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveCommitType(){curCommit.type=document.getElementById('ctype').value;askCommitAmount();}
function askCommitAmount(){show(`<label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:</label><br>
<input type="number" id="camt"><br><button onclick="saveCommitAmount()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveCommitAmount(){curCommit.amount=parseFloat(document.getElementById('camt').value)||0;askCommitMonths();}
function askCommitMonths(){show(`<label>Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</label><br>
<input type="range" id="cmon" min="1" max="60" value="12" oninput="cmonVal.innerText=this.value">
<br><span id="cmonVal">12</span> Ø´Ù‡Ø±<br><button onclick="saveCommitMonths()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveCommitMonths(){curCommit.months=parseInt(document.getElementById('cmon').value);
  curCommit.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©'?askLastPayQ():finishCommit(0);}
function askLastPayQ(){show(`<label>Ù‡Ù„ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø©ØŸ</label><br>
<select id="hasLast"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
<button onclick="saveLastPayQ()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveLastPayQ(){document.getElementById('hasLast').value==='Ù†Ø¹Ù…'?askLastPay():finishCommit(0);}
function askLastPay(){show(`<label>Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©:</label><br>
<input type="number" id="last"><br><button onclick="saveLastPay()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveLastPay(){finishCommit(parseFloat(document.getElementById('last').value)||0);}
function finishCommit(last){curCommit.lastPayment=last;commitments.push({...curCommit});curCommit={};askMore();}
function askMore(){show(`<label>Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰ØŸ</label><br>
<select id="more"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
<button onclick="saveMore()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);}
function saveMore(){document.getElementById('more').value==='Ù†Ø¹Ù…'?askCommitType():calculate();}

/* Ø§Ù„Ø­Ø§Ø³Ø¨Ø© */
function calculate(){
  const S=answers.salary,dur=answers.duration,rate=answers.profitMargin,type=answers.financeType;
  const baseDed=(type==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'?0.3333:(S<15000?0.55:0.65));
  const fullDed=(type==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'&&commitments.length?0.45:baseDed);

  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ */
  let schedule=Array(dur).fill(type==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'?0:S*baseDed);

  commitments.forEach(c=>{
    for(let i=0;i<c.months&&i<dur;i++)schedule[i]-=c.amount;
    if(c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©'&&c.lastPayment){
      const spread=Math.min(24,dur);
      const extra=c.lastPayment/spread;
      for(let i=dur-spread;i<dur;i++)schedule[i]-=extra;
    }
  });

  if(type==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'){
    const cap=S*0.3333;
    for(let i=0;i<dur;i++){
      const allow=S*fullDed-schedule[i];          // Ù…Ø§ ØªØ¨Ù‚Ù‰ Ù…Ù† 45%
      schedule[i]+=Math.min(Math.max(allow,0),cap);
    }
  }

  /* Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· */
  let total=schedule.reduce((a,b)=>a+b,0);
  const factor=(dur/12)*(rate/100)+1;
  const netFinance=total/factor;
  const fee=Math.min(5000,netFinance*0.01);
  const vat=Math.min(750,fee*0.15);
  const netAfter=netFinance-(fee+vat);

  const first=schedule.findIndex(v=>v>0);
  const firstInstall=schedule[first];

  show(`<h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©:</h2>
    <p><strong>Ù‚Ø³Ø·Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª:</strong> ${firstInstall.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø«Ù… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:</strong> ${(S*baseDed).toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${netFinance.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:</strong> ${fee.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${vat.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${netAfter.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø±Ø¨Ø­:</strong> ${(netFinance-netAfter).toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <h3>ğŸ“ Ù„Ù„ØªÙˆØ§ØµÙ„: 0506214458 â€“ hlooleqrr.com</h3>`);
}
</script>

<!-- Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
<script>
setInterval(()=>{
  const d=new Date();
  document.getElementById('datetime').innerText=
    d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0')+' '+
    String(d.getHours()).padStart(2,'0')+':'+String(d.getMinutes()).padStart(2,'0')+':'+String(d.getSeconds()).padStart(2,'0');
},1000);
</script>
</body>
</html>