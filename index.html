<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ â€“ Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±</title>

  <style>
    body{font-family:'Tajawal',sans-serif;background:#f4f6f8;margin:0;text-align:center}
    header{background:#005c48;color:#fff;padding:20px}
    .container{max-width:600px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;
               box-shadow:0 0 15px rgba(0,0,0,.1)}
    input,select,button{width:90%;padding:10px;margin:10px 0;font-size:16px;border-radius:5px;border:1px solid #ccc}
    button{background:#00796b;color:#fff;border:none;cursor:pointer}
    button:hover{background:#004d40}
    footer{font-size:12px;color:#666;margin-top:40px;padding:10px}
    .fade-in{opacity:0;transform:translateY(20px);animation:fadeIn .6s forwards}
    @keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>

<header>
  <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</p>
</header>

<div class="container" id="form-container">
  <div id="question"></div>
  <button onclick="nextQuestion()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
</div>

<script>
/* ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ========== */
let answers = {commitments: []};
let step = 0, commitmentIndex = 0;
const months60  = [...Array(60 ).keys()].map(x=>x+1);
const months360 = [...Array(360).keys()].map(x=>x+1);

const baseQuestions = [
  {id:'financeType', label:'Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„', type:'select', options:['ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ','ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ']},
  {id:'supported',  label:'Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ', type:'select', options:['Ù…Ø¯Ø¹ÙˆÙ…','ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'],
    show:a=>a.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'},
  {id:'bundle', label:'Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ',
    type:'select', options:['Ù†Ø¹Ù…','Ù„Ø§'], show:a=>a.supported==='Ù…Ø¯Ø¹ÙˆÙ…'},
  {id:'salary', label:'ÙƒÙ… Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ', type:'number'},
  {id:'months', label:'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ù„Ù„ØªÙ…ÙˆÙŠÙ„', type:'range', min:1, max:360, value:240},
  {id:'profitMargin', label:'Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%)ØŸ', type:'number'},
  {id:'hasCommitments', label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§']}
];

/* ========== Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ ========== */
function showQuestion(){
  const zone=document.getElementById('question');
  zone.innerHTML='';
  const q=getCurrentQuestion();
  if(!q){ calculate(); document.querySelector('button').style.display='none'; return;}
  if(q.show && !q.show(answers)){step++;showQuestion();return;}

  const wrap=document.createElement('div');wrap.className='fade-in';
  wrap.innerHTML=`<label>${q.label}</label><br/>`;
  if(q.type==='select'){
    const sel=document.createElement('select');sel.id=q.id;
    q.options.forEach(o=>sel.add(new Option(o,o)));wrap.appendChild(sel);
  }else if(q.type==='range'){
    const input=document.createElement('input');
    input.type='range'; input.min=q.min; input.max=q.max; input.value=q.value;
    input.id=q.id; input.oninput=()=>val.textContent=input.value;
    const val=document.createElement('span');val.id=q.id+'Val';val.textContent=q.value;
    wrap.append(input,' ',val,' Ø´Ù‡Ø±');
  }else{const inp=document.createElement('input');inp.type='number';inp.id=q.id;wrap.appendChild(inp);}
  zone.appendChild(wrap);
}

function getCurrentQuestion(){
  if(step<baseQuestions.length) return baseQuestions[step];
  if(answers.hasCommitments==='Ù†Ø¹Ù…'){
    const c=answers.commitments[commitmentIndex]||{};
    if(!c.type)   return {id:'type',type:'select',label:'Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…',options:['Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ','Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©','Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ']};
    if(!c.amount) return {id:'amount',type:'number',label:'ÙƒÙ… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ'};
    if(!c.months){
      return {id:'monthsRemain',type:'select',label:'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©',
              options:months60.map(m=>m+' Ø´Ù‡Ø±')};
    }
    if(c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && !c.balloonAsked){
      c.balloonAsked=true;
      return {id:'balloon',type:'number',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø©ØŸ Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø£Ùˆ 0'};
    }
    if(!c.askMore) return {id:'more',type:'select',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰ØŸ',options:['Ù†Ø¹Ù…','Ù„Ø§']};
  }
  return null;
}

/* ========== Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ ========== */
function nextQuestion(){
  const q=getCurrentQuestion(); if(!q) return;
  const val=document.getElementById(q.id)?.value||null;

  if(step<baseQuestions.length){ answers[q.id]=val; step++; }
  else{
    let c=answers.commitments[commitmentIndex]||{};
    if(!c.type) c.type=val;
    else if(!c.amount) c.amount=parseFloat(val)||0;
    else if(!c.months) c.months=parseInt(val)||0;
    else if(c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && c.balloon===undefined){ c.balloon=parseFloat(val)||0; }
    else if(!c.askMore){
      c.askMore=val;
      if(val==='Ù†Ø¹Ù…'){commitmentIndex++;answers.commitments.push({});}
    }
    answers.commitments[commitmentIndex]=c;
  }

  /* Ø¶Ø¨Ø· Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ø£Ø´Ù‡Ø± Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ */
  if(q.id==='financeType'){
    const monthsQ=baseQuestions.find(x=>x.id==='months');
    monthsQ.max = (val==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ')?60:360;
    if(document.getElementById('months')) document.getElementById('months').max=monthsQ.max;
  }

  showQuestion();
}

/* ========== Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ø¹ Ø§Ù„Ø±Ø¨Ø­ ========== */
function calculate(){
  const salary = +answers.salary||0,
        months = +answers.months||0,
        years  = months/12,
        profit = +answers.profitMargin||0,
        type   = answers.financeType;

  /* Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ø®ØµÙ… */
  let rate=0, extraSupport=0, addCommodity=false;
  if(type==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'){rate=45; addCommodity=true;}
  else{
    const sup=answers.supported,bundle=answers.bundle;
    rate = salary<15000?55:65;
    if(sup==='Ù…Ø¯Ø¹ÙˆÙ…'&&bundle==='Ù†Ø¹Ù…'){
      extraSupport = salary<10000?150000:100000;
    }
  }

  /* Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª */
  let schedule=[];            // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
  let maxMonths=0;

  if(answers.hasCommitments==='Ù†Ø¹Ù…'){
    // Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª
    let tempMonths=0;
    answers.commitments.forEach(c=>{
      const m=c.months||0;
      const amt=c.amount||0;
      maxMonths=Math.max(maxMonths,m);
      let balloonMonthly=0;
      if(c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && c.balloon){
        // ØªÙˆØ²Ø¹ Ø¹Ù„Ù‰ Ø¢Ø®Ø± 24 Ø´Ù‡Ø± Ù…Ù† Ù…Ø¯Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø£Ùˆ Ø£Ù‚Ù„ Ø¥Ø°Ø§ Ø§Ù„Ù…Ø¯Ø© Ø£Ù‚Ù„
        const distribute=Math.min(24,m);
        balloonMonthly=c.balloon/distribute;
      }
      for(let i=0;i<m;i++){
        schedule[i]=(schedule[i]||0)+amt+(i>=m-24?balloonMonthly:0);
      }
      tempMonths=Math.max(tempMonths,m);
    });
  }

  // Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø­ØªÙ‰ Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
  for(let i=schedule.length;i<months;i++) schedule[i]=0;

  /* Ø¨Ù†Ø§Ø¡ Ù‚Ø³Ø· Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ */
  const personalCap = salary*0.3333;
  const allowed     = salary*rate/100;

  let payments=[];
  for(let i=0;i<months;i++){
    const obligations=schedule[i]||0;
    const avail=allowed-obligations;
    const personal=Math.min(personalCap,avail>0?avail:0);
    payments[i]=personal;
  }

  /* Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ: Ø§Ù„Ù‚Ø³Ø· Ø«Ø§Ø¨Øª Ø­Ø³Ø¨ allowed-rate */
  if(type==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'){
    const cap = salary*rate/100 - (schedule[0]||0);
    payments = Array(months).fill(cap>0?cap:0);
  }

  /* Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ø§Ù„Øº */
  const totalInst = payments.reduce((a,b)=>a+b,0);
  const profitFactor = years*profit/100 + 1;
  const netFinance   = totalInst/profitFactor;

  /* Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ */
  const profitWithout = totalInst - netFinance;

  /* Ø§Ù„Ø±Ø³ÙˆÙ… */
  let admin=netFinance*0.01; if(admin>5000)admin=5000;
  const vat=admin*0.15; // 750 Ø¥Ø°Ø§ admin 5000
  const commodity = addCommodity?netFinance*0.01:0;
  const feesTotal = admin+vat+commodity;
  const finalNet  = netFinance-feesTotal;
  const profitWith = profitWithout + feesTotal;

  /* Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© */
  document.getElementById('question').innerHTML=`
    <h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©:</h2>
    <p><strong>Ù‚Ø³Ø·Ùƒ Ø®Ù„Ø§Ù„ Ø£ÙˆÙ„ ${months>0?months:0} Ø´Ù‡Ø± (Ù‚Ø³Ø·Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯):</strong> ${payments[0].toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø«Ù… Ù‚Ø³Ø·Ùƒ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…:</strong> ${type==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'?personalCap.toFixed(0):(salary*rate/100).toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong> ${totalInst.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­:</strong> ${profitFactor.toFixed(3)}</p>
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${netFinance.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:</strong> ${admin.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${vat.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    ${addCommodity?`<p><strong>Ø±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹:</strong> ${commodity.toFixed(0)} Ø±ÙŠØ§Ù„</p>`:''}
    <p><strong>Ø§Ù„Ø±Ø¨Ø­ Ø¯ÙˆÙ† Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${profitWithout.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${profitWith.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> ${finalNet.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    ${extraSupport?`<p><strong>Ø¯Ø¹Ù… Ø­ÙƒÙˆÙ…ÙŠ Ù…Ø¶Ø§Ù:</strong> ${extraSupport.toLocaleString()} Ø±ÙŠØ§Ù„</p>`:''}
    <h3 style="margin-top:20px;">ğŸ“ Ù„Ù„ØªÙˆØ§ØµÙ„: 0506214458 â€“ hlooleqrr.com</h3>
  `;
}

/* ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ Ø³Ø¤Ø§Ù„ */
showQuestion();
</script>

<footer>
  <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€“ Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© â€“ <span id="datetime"></span></p>
</footer>
<script>
function updateDateTime(){
  const d=new Date(); document.getElementById('datetime').textContent =
    `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${String(d.getSeconds()).padStart(2,'0')}`;
}
setInterval(updateDateTime,1000); updateDateTime();
</script>

</body>
</html>