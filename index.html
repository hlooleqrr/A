<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ - Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±</title>

  <!-- ====== Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ====== -->
  <style>
    body{font-family:'Tajawal',sans-serif;background:#f4f6f8;margin:0;text-align:center}
    header{background:#005c48;color:#fff;padding:20px}
    .container{max-width:600px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1)}
    input,select,button{width:90%;padding:10px;margin:10px 0;font-size:16px;border-radius:5px;border:1px solid #ccc}
    button{background:#00796b;color:#fff;border:none;cursor:pointer}
    button:hover{background:#004d40}
    footer{font-size:12px;color:#666;margin-top:40px;padding:10px}
    .fade-in{opacity:0;transform:translateY(20px);animation:fadeInMove .6s forwards}
    @keyframes fadeInMove{to{opacity:1;transform:translateY(0)}}
  </style>
</head>

<body>
<header>
  <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</p>
</header>

<!-- ====== Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ====== -->
<div class="container" id="form-container">
  <div id="question"></div>
  <button id="mainButton" onclick="handleStartOrReset()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
  <div id="nextContainer" style="display:none">
    <button onclick="nextQuestion()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
  </div>
</div>

<!-- ====== Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ====== -->
<script>
/*** Ù…ØªØºÙŠÙ‘Ø±Ø§Øª Ø¹Ø§Ù…Ù‘Ø© ***/
let answers = { commitments: [] }, step = 0, commitmentStep = 0, currentCommitment = {};
let hasStarted = false;

/*** Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ù‘Ø© ***/
const generalQuestions = [
  { id:'financeType',label:'Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„',type:'select',options:['ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ','ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'] },
  { id:'supported',label:'Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ',type:'select',options:['Ù…Ø¯Ø¹ÙˆÙ…','ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'],
    show:a=>a.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' },
  { id:'bundle',label:'Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'],
    show:a=>a.supported==='Ù…Ø¯Ø¹ÙˆÙ…' },
  { id:'salary',label:'ÙƒÙ… Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ',type:'number' },
  {
  id:'months',
  label:'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ù„Ù„ØªÙ…ÙˆÙŠÙ„',
  type:'range',
  min:12,
{
  id: 'months',
  label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ù„Ù„ØªÙ…ÙˆÙŠÙ„',
  type: 'range',
  min: 12,
  max: 360,
  value: 240,
  show: a => true,
  render: (a) => {
    const isPersonal = a.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ';
    return `
      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ù„Ù„ØªÙ…ÙˆÙŠÙ„</label><br>
      <input type="range" id="months" min="12" max="${isPersonal ? 60 : 360}" value="${isPersonal ? 60 : 240}"
        oninput="document.getElementById('monthsVal').textContent=this.value">
      <br><span id="monthsVal">${isPersonal ? 60 : 240}</span> Ø´Ù‡Ø±
    `;
  }
}
},
  { id:'profitMargin',label:'Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%)ØŸ',type:'number' },
  { id:'hasCommitments',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'] }
];

/*** Ø£Ø³Ø¦Ù„Ø© ÙƒÙ„ Ø§Ù„ØªØ²Ø§Ù… ***/
const commitmentQuestions = [
  { id:'type',label:'Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…',type:'select',options:['Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ','Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©','Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ'] },
  { id:'amount',label:'ÙƒÙ… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ',type:'number' },
  { id:'months',label:'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©ØŸ',type:'select',
    options:Array.from({length:60},(_,i)=>(i+1)+' Ø´Ù‡Ø±') },
  { id:'more',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰ØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'] }
];

/*** Ø²Ø± Ø§Ø¨Ø¯Ø£/Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø© ***/
function handleStartOrReset(){
  if(!hasStarted){
    hasStarted = true;
    document.getElementById('mainButton').textContent = 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©';
    showQuestion();
  }else{
    resetCalc();
  }
}

/*** Ø¥Ø¹Ø§Ø¯Ø© ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ù† Ø§Ù„ØµÙØ± ***/
function resetCalc(){
  answers = { commitments: [] };
  step = commitmentStep = 0;
  currentCommitment = {};
  hasStarted = true;
  document.getElementById('mainButton').textContent = 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©';
  showQuestion();
}

/*** Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ ***/
function showQuestion(){
  const cont = document.getElementById('question');
  cont.innerHTML = '';
  document.getElementById('nextContainer').style.display = 'block';

  let q;
  if(step < generalQuestions.length){
    q = generalQuestions[step];
    if(q.show && !q.show(answers)){ step++; showQuestion(); return; }
  }else if(answers.hasCommitments === 'Ù†Ø¹Ù…'){
    q = commitmentQuestions[commitmentStep];
  }else{
    document.getElementById('nextContainer').style.display = 'none';
    calculate(); return;
  }

  const div = document.createElement('div'); div.classList.add('fade-in');
  div.innerHTML = `<label>${q.label}</label><br>`;
  if(q.type==='select'){
    const sel = document.createElement('select'); sel.id = q.id;
    q.options.forEach(opt=>{
      sel.innerHTML += `<option value="${opt}">${opt}</option>`;
    });
    div.appendChild(sel);
  }else if(q.type==='range'){
    div.innerHTML += `<input type="range" id="${q.id}" min="${q.min}" max="${q.max}" value="${q.value}"
                       oninput="document.getElementById('${q.id}Val').textContent=this.value">
                      <br><span id="${q.id}Val">${q.value}</span> Ø´Ù‡Ø±`;
  }else{
    div.innerHTML += `<input type="number" id="${q.id}">`;
  }
  cont.appendChild(div);
}

/*** Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ù„ØªØ§Ù„ÙŠ" ***/
function nextQuestion(){
  const q = step < generalQuestions.length ? generalQuestions[step] : commitmentQuestions[commitmentStep];
  const val = document.getElementById(q.id)?.value;

  if(step < generalQuestions.length){
    answers[q.id] = val; step++;
  }else{
    if(q.id==='months')       currentCommitment[q.id] = parseInt(val);
    else if(q.id==='amount')  currentCommitment[q.id] = parseFloat(val);
    else                      currentCommitment[q.id] = val;

    if(q.id==='more'){
      answers.commitments.push(currentCommitment); currentCommitment = {};
      if(val==='Ù†Ø¹Ù…'){ commitmentStep = 0; showQuestion(); return; }
      else{ document.getElementById('nextContainer').style.display='none'; calculate(); return; }
    }
    commitmentStep++;
  }
  showQuestion();
}

/*** Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ***/
function calculate(){
  const salary = parseFloat(answers.salary),
        months = parseInt(answers.months),
        years  = months/12,
        profitMargin = parseFloat(answers.profitMargin),
        { financeType, supported, bundle } = answers;

  /* Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ */
  let deductionRate = 0, extraSupport = 0, addCommodityFee = false;
  if(financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'){
    if(months>60){ alert('Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² 60 Ø´Ù‡Ø±'); return; }
    deductionRate = 33.33;          // Ø­Ø³Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
    addCommodityFee = true;
  }else{                           // ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ
    if(supported === 'Ù…Ø¯Ø¹ÙˆÙ…'){
      if(bundle === 'Ù„Ø§'){ deductionRate = 65; extraSupport = salary<10000?150000:100000; }
      else{ deductionRate = salary<15000?55:65; }
    }else{ deductionRate = salary<15000?55:65; }
  }

  /* Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØºÙŠÙ‘Ø±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª */
  let allowedInst = salary * deductionRate / 100;
  let commits = [...answers.commitments].sort((a,b)=>parseInt(a.months)-parseInt(b.months));
  let schedule = [], curMonth = 0;
  for(let i=0;i<=commits.length;i++){
    const cut = i<commits.length?parseInt(commits[i].months):months,
          period = cut - curMonth;
    if(period>0){
      const active = commits.slice(i).reduce((s,c)=>s+(c.amount||0),0),
            avail  = allowedInst - active;
      schedule.push({months:period,inst:avail});
      curMonth = cut;
    }
  }

  /* Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· */
  const totalInst = schedule.reduce((s,p)=>s+p.inst*p.months,0);
  const profitFactor = (years * profitMargin / 100)+1;
  const netFinance   = totalInst / profitFactor;

  /* Ø§Ù„Ø±Ø³ÙˆÙ… */
  let adminFee = netFinance*0.01, vat = adminFee*0.15;
  if(adminFee+vat>5750){ adminFee=5000; vat=750; }
  const commodityFee = addCommodityFee ? netFinance*0.01 : 0;
  const finalNet = netFinance - (adminFee+vat+commodityFee);

  /* Ù†Øµ Ø§Ù„Ø¯Ø¹Ù… / Ø§Ù„Ø¨Ø§Ù‚Ø© */
  let supportText='';
  if(financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && supported==='Ù…Ø¯Ø¹ÙˆÙ…'){
    if(bundle==='Ù†Ø¹Ù…'){
      const sup=salary<10000?150000:100000;
      supportText = `<p><strong>Ø¯Ø¹Ù… Ø­ÙƒÙˆÙ…ÙŠ Ù…Ø¶Ø§Ù:</strong> ${sup.toLocaleString()} Ø±ÙŠØ§Ù„</p>`;
    }else{
      const sup=salary<10000?150000:100000,
            dist=Math.min(months,240),
            monthly=Math.round(sup/dist);
      supportText = `<p><strong>ØªÙ… ØªÙˆØ²ÙŠØ¹ Ø¯Ø¹Ù… Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© (${sup.toLocaleString()} Ø±ÙŠØ§Ù„) Ø¹Ù„Ù‰ ${dist} Ø´Ù‡Ø± = ${monthly.toLocaleString()} Ø±ÙŠØ§Ù„ Ù„ÙƒÙ„ Ø´Ù‡Ø±</strong></p>`;
    }
  }

  /* Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© */
  let html = '<h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©:</h2>';
  schedule.forEach((p,i)=>{
    const from=schedule.slice(0,i).reduce((s,x)=>s+x.months,0)+1,
          to  =from+p.months-1;
    html += `<p><strong>Ø§Ù„Ù‚Ø³Ø· Ù…Ù† Ø§Ù„Ø´Ù‡Ø± ${from} Ø¥Ù„Ù‰ ${to}:</strong> ${p.inst.toFixed(0)} Ø±ÙŠØ§Ù„</p>`;
  });
  html += `
    <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong> ${totalInst.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­:</strong> ${profitFactor.toFixed(3)}</p>
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${netFinance.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:</strong> ${adminFee.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${vat.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    ${addCommodityFee?`<p><strong>Ø±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹:</strong> ${commodityFee.toFixed(0)} Ø±ÙŠØ§Ù„</p>`:''}
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> ${finalNet.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø±Ø¨Ø­:</strong> ${ (totalInst - netFinance).toFixed(0) } Ø±ÙŠØ§Ù„</p>
<p><strong>Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ… (Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© + Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ${addCommodityFee ? '+ Ø§Ù„Ø³Ù„Ø¹' : ''}):</strong> ${ (totalInst - finalNet).toFixed(0) } Ø±ÙŠØ§Ù„</p>
    ${supportText}
    <h3 style="margin-top:20px;">ğŸ“ Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h3>
    <p>0506214458 â€“ hlooleqrr.com</p>`;
  document.getElementById('question').innerHTML = html;
}

/*** ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª ÙÙŠ Ø§Ù„ÙÙˆØªØ± ***/
function updateDateTime(){
  const n=new Date();
  document.getElementById('datetime').innerText =
    `${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')} `+
    `${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}:${String(n.getSeconds()).padStart(2,'0')}`;
}
setInterval(updateDateTime,1000); updateDateTime();
</script>

<footer>
  <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© - <span id="datetime"></span></p>
</footer>
</body>
</html>