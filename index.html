<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>حاسبة التمويل</title>
  <style>
    body{font-family:'Tajawal',sans-serif;background:#f4f6f8;margin:0;text-align:center;font-size:18px}
    header{background:#005c48;color:#fff;padding:20px}
    .container{max-width:600px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1)}
    input,select,button{width:90%;padding:12px;margin:10px 0;font-size:18px;border-radius:5px;border:1px solid #ccc}
    button{background:#00796b;color:#fff;border:none;cursor:pointer}
    button:hover{background:#004d40}
    .small-reset{font-size:14px;padding:5px 10px;margin-top:20px;background:#e3f2fd;color:#1565c0;border:none;cursor:pointer;border-radius:15px}
    .small-reset:hover{background:#bbdefb}
    footer{font-size:13px;color:#666;margin-top:40px;padding:10px}
    .fade-in{opacity:0;transform:translateY(20px);animation:fadeInMove .6s forwards}
    @keyframes fadeInMove{to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>
<header>
  <h1>سرعة تملك العقار والحلول التمويلية</h1>
  <p>حاسبة التمويل التقريبية</p>
</header>
<div class="container" id="form-container">
  <div id="question"></div>
  <button id="mainButton" onclick="handleStartOrReset()">ابدأ الحسبة</button>
  <div id="nextContainer" style="display:none">
    <button onclick="nextQuestion()">التالي</button>
  </div>
  <div id="resetButtonContainer" style="display:none">
    <button class="small-reset" onclick="resetCalc()">🔁 إعادة الحسبة</button>
  </div>
</div>
<script>
let answers = { commitments: [] }, step = 0, commitmentStep = 0, currentCommitment = {};
let hasStarted = false;

const generalQuestions = [
  { id:'financeType',label:'نوع التمويل',type:'select',options:['تمويل عقاري','تمويل شخصي'] },
  { id:'supported',label:'هل التمويل مدعوم؟',type:'select',options:['مدعوم','غير مدعوم'],show:a=>a.financeType==='تمويل عقاري' },
  { id:'bundle',label:'هل ترغب في دفعة مقدمة من سكني؟',type:'select',options:['نعم','لا'],show:a=>a.supported==='مدعوم' },
  { id:'salary',label:'كم الراتب الشهري؟',type:'number' },
  { id:'months',label:'عدد الأشهر للتمويل',type:'select',options:Array.from({length:349},(_,i)=>(i+12)+' شهر'),show:a=>a.financeType==='تمويل عقاري' },
  { id:'months',label:'عدد الأشهر للتمويل',type:'select',options:Array.from({length:49},(_,i)=>(i+12)+' شهر'),show:a=>a.financeType==='تمويل شخصي' },
  { id:'profitMargin',label:'نسبة هامش الربح السنوي (%)؟',type:'number' },
  { id:'hasCommitments',label:'هل لديك التزامات؟',type:'select',options:['نعم','لا'] }
];

const commitmentQuestions = [
  { id:'type',label:'نوع الالتزام',type:'select',options:['قرض شخصي','قرض سيارة','قرض استهلاكي'] },
  { id:'amount',label:'كم القسط الشهري؟',type:'number' },
  { id:'months',label:'كم عدد الأشهر المتبقية؟',type:'select',options:Array.from({length:60},(_,i)=>(i+1)+' شهر') },
  { id:'balloon',label:'هل لديك دفعة أخيرة؟',type:'select',options:['نعم','لا'],show:c=>c.type==='قرض سيارة' },
  { id:'balloonAmount',label:'كم مبلغ الدفعة الأخيرة؟',type:'number',show:c=>c.balloon==='نعم' },
  { id:'more',label:'هل لديك التزامات أخرى؟',type:'select',options:['نعم','لا'] }
];

function handleStartOrReset(){
  if(!hasStarted){
    hasStarted = true;
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    showQuestion();
  }else{ resetCalc(); }
}

function resetCalc(){
  answers = { commitments: [] };
  step = commitmentStep = 0;
  currentCommitment = {};
  hasStarted = true;
  document.getElementById('mainButton').style.display = 'none';
  document.getElementById('resetButtonContainer').style.display = 'block';
  showQuestion();
}

function showQuestion(){
  const cont = document.getElementById('question');
  cont.innerHTML = '';
  document.getElementById('nextContainer').style.display = 'block';
  let q;
  if(step < generalQuestions.length){
    q = generalQuestions[step];
    if(q.show && !q.show(answers)){ step++; showQuestion(); return; }
  }else if(answers.hasCommitments === 'نعم'){
    q = commitmentQuestions[commitmentStep];
    if(q.show && !q.show(currentCommitment)){ commitmentStep++; showQuestion(); return; }
  }else{ document.getElementById('nextContainer').style.display = 'none'; calculate(); return; }

  const div = document.createElement('div'); div.classList.add('fade-in');
  div.innerHTML = `<label>${q.label}</label><br>`;
  if(q.type==='select'){
    const sel = document.createElement('select'); sel.id = q.id;
    sel.innerHTML = '<option value="">اختر...</option>';
    q.options.forEach(opt=>{ sel.innerHTML += `<option value="${opt}">${opt}</option>`; });
    div.appendChild(sel);
  }else{
    div.innerHTML += `<input type="number" id="${q.id}">`;
  }
  cont.appendChild(div);
}
</script>
<script src="https://chat.openai.com/scripts/fin_calc_next.js"></script> <!-- ستكمل الباقي لو أردت تقسيم -->
<footer>
  <p>جميع الحقوق محفوظة - سرعة تملك العقار والحلول التمويلية - <span id="datetime"></span></p>
</footer>
<script>
function updateDateTime(){
  const n = new Date();
  document.getElementById('datetime').innerText =
    `${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')} `+
    `${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}:${String(n.getSeconds()).padStart(2,'0')}`;
}
setInterval(updateDateTime, 1000); updateDateTime();
</script>
</body>
</html>