<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>حاسبة التمويل</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f4f6f8;
      margin: 0;
      text-align: center;
      font-size: 30px;
    }
    header {
      background: #005c48;
      color: #fff;
      padding: 25px;
      font-size: 32px;
    }
    .container {
      max-width: 700px;
      margin: 25px auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,.1);
    }
    input, select, button {
      width: 94%;
      padding: 18px;
      margin: 16px 0;
      font-size: 28px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    select option {
      font-size: 26px;
    }
    button {
      background: #00796b;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #004d40;
    }
    .small-reset {
      font-size: 26px;
      padding: 10px 18px;
      margin-top: 20px;
      background: #e3f2fd;
      color: #1565c0;
      border: none;
      cursor: pointer;
      border-radius: 15px;
    }
    .small-reset:hover {
      background: #bbdefb;
    }
    footer {
      font-size: 24px;
      color: #666;
      margin-top: 40px;
      padding: 15px;
    }
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInMove .6s forwards;
    }
    @keyframes fadeInMove {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .result p {
      margin: 12px 0;
      font-size: 30px;
      line-height: 1.6;
    }
    .result h2, .result h3 {
      font-size: 34px;
    }
    .highlight {
      font-size: 36px;
      font-weight: bold;
      color: #004d40;
    }
    .red-warning {
      color: red;
      font-size: 36px;
      font-weight: bold;
    }
  </style>
</head>
<body>
<header>
  <h1>سرعة تملك العقار والحلول التمويلية</h1>
  <p>حاسبة التمويل التقريبية</p>
</header>
<div class="container" id="form-container">
  <div id="question"></div>
  <button id="mainButton" onclick="handleStartOrReset()">ابدأ الحسبة</button>
  <div id="nextContainer" style="display:none">
    <button onclick="nextQuestion()">التالي</button>
  </div>
  <div id="resetButtonContainer" style="display:none">
    <button class="small-reset" onclick="resetCalc()">🔁 إعادة الحسبة</button>
  </div>
</div><script>
const militaryRanks = {
  "جندي": 44, "جندي أول": 44, "عريف": 46, "وكيل رقيب": 48,
  "رقيب": 50, "رقيب أول": 50, "رئيس رقباء": 52,
  "ملازم": 44, "ملازم أول": 44, "نقيب": 48, "رائد": 50,
  "مقدم": 52, "عقيد": 54, "عميد": 56, "لواء": 58
};

function hijriToGregorianYear(hijriDate) {
  const [y, m, d] = hijriDate.replace('هـ','').trim().split('/').map(x => parseInt(x));
  const estimatedYear = y + 622 - Math.floor(y / 33); 
  const current = new Date();
  return current.getFullYear() - estimatedYear;
}

function getMaxMonths(age, type, rank = null) {
  if (type === "عسكري" && militaryRanks[rank]) {
    return Math.max((militaryRanks[rank] - age) * 12, 0);
  } else {
    return Math.max((60 - age) * 12, 0);
  }
}

function convertMonthsToText(months) {
  const years = Math.floor(months / 12);
  const rem = months % 12;
  let yTxt = years > 0 ? `${convertNumberToArabicText(years)} سنة` : '';
  let mTxt = rem > 0 ? `${convertNumberToArabicText(rem)} شهر` : '';
  return [yTxt, mTxt].filter(Boolean).join(' و');
}

function convertNumberToArabicText(n) {
  const units = ["", "واحد", "اثنين", "ثلاثة", "أربعة", "خمسة", "ستة", "سبعة", "ثمانية", "تسعة"];
  const tens = ["", "", "عشرون", "ثلاثون", "أربعون", "خمسون", "ستون"];
  if (n <= 9) return units[n];
  if (n === 10) return "عشرة";
  if (n < 20) return `${units[n % 10]} عشر`;
  if (n % 10 === 0) return tens[n / 10];
  return `${units[n % 10]} و${tens[Math.floor(n / 10)]}`;
}

let answers = {}, step = 0;

const generalQuestions = [
  { id:'financeType',label:'اختر نوع التمويل:',type:'select',options:['تمويل شخصي أو تمويل استهلاكي','تمويل عقاري'] },
  { id:'jobType',label:'ما نوع الوظيفة؟',type:'select',options:['عسكري','مدني','قطاع خاص شبه حكومي','قطاع خاص معتمد لدى البنك','قطاع خاص غير معتمد'] },
  { id:'birthDate',label:'ما تاريخ ميلادك؟ (هجري)',type:'text',placeholder:'مثال: 1400/07/01هـ' },
  { id:'rank',label:'اذكر الرتبة العسكرية',type:'select',options:Object.keys(militaryRanks),show:a=>a.jobType==='عسكري' },
  { id:'salary',label:'كم الراتب الشهري الصافي؟',type:'number' },
  { id:'months',label:'على كم شهر تريد التمويل؟',type:'select',options:[],dynamic:true },
  { id:'profitMargin',label:'نسبة هامش الربح السنوي (%)؟',type:'number' }
];<script>
function handleStartOrReset(){
  if(!hasStarted){
    hasStarted = true;
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    showQuestion();
  } else { resetCalc(); }
}

function resetCalc(){
  answers = {};
  step = 0;
  hasStarted = true;
  document.getElementById('mainButton').style.display = 'none';
  document.getElementById('resetButtonContainer').style.display = 'block';
  showQuestion();
}

function showQuestion(){
  const cont = document.getElementById('question');
  cont.innerHTML = '';
  document.getElementById('nextContainer').style.display = 'block';
  let q;
  while(step < generalQuestions.length){
    q = generalQuestions[step];
    if(q.show && !q.show(answers)){ step++; continue; }
    break;
  }
  if(!q){ document.getElementById('nextContainer').style.display = 'none'; calculate(); return; }

  const div = document.createElement('div'); div.classList.add('fade-in');
  div.innerHTML = `<label>${q.label}</label><br>`;
  if(q.type==='select'){
    const sel = document.createElement('select'); sel.id = q.id;
    sel.innerHTML = '<option value="">اختر...</option>';
    if(q.dynamic && q.id==='months'){
      const age = hijriToGregorianYear(answers.birthDate || "1400/07/01");
      const maxMonths = getMaxMonths(age, answers.jobType, answers.rank);
      for(let i=1; i<=maxMonths; i++){
        const text = `${i} شهر${i>1?' – '+convertMonthsToText(i):''}`;
        sel.innerHTML += `<option value="${i}">${text}</option>`;
      }
    } else {
      q.options.forEach(opt=>{ sel.innerHTML += `<option value="${opt}">${opt}</option>`; });
    }
    div.appendChild(sel);
  }else{
    const inp = document.createElement('input');
    inp.type = q.type || 'text'; inp.id = q.id;
    if(q.placeholder) inp.placeholder = q.placeholder;
    div.appendChild(inp);
  }
  cont.appendChild(div);
}

function nextQuestion(){
  const q = generalQuestions[step];
  const el = document.getElementById(q.id);
  const val = el?.value?.trim();
  if(!val){ alert('يرجى تعبئة الحقل قبل المتابعة'); return; }
  answers[q.id] = val;
  step++;
  showQuestion();
}
</script><script>
function calculate(){
  const salary = parseFloat(answers.salary);
  const months = parseInt(answers.months);
  const years = months / 12;
  const profitMargin = parseFloat(answers.profitMargin);

  let deductionRate = 65;
  if(answers.financeType.includes('شخصي')) deductionRate = 45;

  const allowedInst = salary * (deductionRate / 100);
  const totalInst = allowedInst * months;
  const profitFactor = (years * profitMargin / 100) + 1;
  const netFinance = totalInst / profitFactor;

  let adminFee = netFinance * 0.01, vat = adminFee * 0.15;
  if(adminFee + vat > 5750){ adminFee = 5000; vat = 750; }
  const finalNet = netFinance - (adminFee + vat);
  const totalProfit = totalInst - finalNet;

  const resultDiv = document.createElement('div');
  resultDiv.classList.add('result');
  let html = '<h2>نتيجة الحسبة (التقريبية):</h2>';

  if (allowedInst <= 0 || netFinance <= 0) {
    html += `<p class="red-warning">❌ نعتذر منك، لا يمكن تمويلك</p>`;
  }

  const toText = n => {
    const parts = n.toFixed(4).split(".");
    const main = parseInt(parts[0]).toLocaleString();
    const halalah = parseInt(parts[1]) > 0 ? `${parseInt(parts[1])} هلالات` : '';
    return [main, halalah].filter(Boolean).join('.');
  };

  const arabicText = n => {
    const riyals = Math.floor(n);
    const parts = riyals.toLocaleString() + ' ريال';
    const dec = Math.round((n - riyals) * 10000);
    const halalahText = dec > 0 ? `${convertNumberToArabicText(dec)} هلالات` : '';
    return [parts, halalahText].filter(Boolean).join(' و');
  };

  html += `
    <p><strong>القسط الشهري:</strong> ${allowedInst.toFixed(0)} ريال</p>
    <p style="font-size: 32px; color: #004d40; font-weight: bold;">مدة التمويل: ${months} شهر – ${convertMonthsToText(months)}</p>
    <p><strong>التمويل الصافي بعد خصم الرسوم:</strong> ${toText(finalNet)}<br>(${arabicText(finalNet)})</p>
    <p><strong>التمويل الصافي قبل الرسوم:</strong> ${toText(netFinance)}<br>(${arabicText(netFinance)})</p>
    <p><strong>الربح مع الرسوم:</strong> ${toText(totalProfit)}<br>(${arabicText(totalProfit)})</p>
    <p><strong>الرسوم الإدارية:</strong> ${adminFee.toFixed(0)} ريال</p>
    <p><strong>ضريبة القيمة المضافة:</strong> ${vat.toFixed(0)} ريال</p>
    <p><strong>إجمالي التمويل مع الأرباح:</strong> ${totalInst.toFixed(0)} ريال</p>
    <h3 style="margin-top:30px;">📞 للاستفسار: 0506214458 | الموقع: hlooleqrr.com</h3>
  `;
  document.getElementById('question').innerHTML = html;
}
</script>
</body>
</html>
</script>