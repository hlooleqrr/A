<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± â€“ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„</title>
  <style>
    body{font-family:'Tajawal',sans-serif;background:#f4f6f8;margin:0;text-align:center}
    header{background:#005c48;color:#fff;padding:24px 10px}
    .container{max-width:600px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1)}
    input,select,button{width:90%;padding:10px;margin:10px 0;font-size:16px;border-radius:5px;border:1px solid #ccc}
    button{background:#00796b;color:#fff;border:none;cursor:pointer}
    button:hover{background:#004d40}
    footer{font-size:12px;color:#666;margin-top:40px;padding:10px}
    .fade-in{opacity:0;transform:translateY(20px);animation:fadeIn .5s forwards}
    @keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>
<header>
  <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</p>
</header>
<div class="container" id="form">
  <button id="startBtn" onclick="start()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
  <div id="question"></div>
</div>

<script>
let answers={}, commitments=[], curCommit={};

function show(html){ document.getElementById('question').innerHTML = '<div class="fade-in">'+html+'</div>'; }
function start(){
  document.getElementById("startBtn").innerText = "Ø£Ø¹Ø¯ Ø§Ù„Ø­Ø³Ø¨Ø©";
  answers = {}; commitments = []; curCommit = {};
  askFinanceType();
}

function askFinanceType(){
  show(`<label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„:</label><br>
    <select id="ft"><option>ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option><option>ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ</option></select><br>
    <button onclick="saveFinanceType()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveFinanceType(){
  answers.financeType = document.getElementById('ft').value;
  (answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ') ? askSupport() : askSalary();
}
function askSupport(){
  show(`<label>Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ</label><br>
    <select id="sup"><option>Ù…Ø¯Ø¹ÙˆÙ…</option><option>ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…</option></select><br>
    <button onclick="saveSupport()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveSupport(){
  answers.supported = document.getElementById('sup').value;
  (answers.supported === 'Ù…Ø¯Ø¹ÙˆÙ…') ? askBundle() : askSalary();
}
function askBundle(){
  show(`<label>Ù‡Ù„ ØªØ±ØºØ¨ Ø¨Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù‘Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ</label><br>
    <select id="bun"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
    <button onclick="saveBundle()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveBundle(){ answers.bundle = document.getElementById('bun').value; askSalary(); }
function askSalary(){
  show(`<label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±ÙŠØ§Ù„):</label><br>
    <input type="number" id="sal"><br>
    <button onclick="saveSalary()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveSalary(){ answers.salary = parseFloat(document.getElementById('sal').value) || 0; askProfit(); }
function askProfit(){
  show(`<label>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%):</label><br>
    <input type="number" id="pr"><br>
    <button onclick="saveProfit()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveProfit(){ answers.profitMargin = parseFloat(document.getElementById('pr').value) || 0; askDuration(); }
function askDuration(){
  const max = answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ' ? 60 : 360;
  const defaultVal = 240;
  show(`<label>Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø£Ø´Ù‡Ø±):</label><br>
    <select id="dur">
      ${Array.from({length: max - 11}, (_, i) => {
        const val = i + 12;
        return `<option value="${val}" ${val === defaultVal ? "selected" : ""}>${val} Ø´Ù‡Ø±</option>`;
      }).join('')}
    </select><br>
    <button onclick="saveDuration()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveDuration(){ answers.duration = parseInt(document.getElementById('dur').value); askHasCommit(); }

function askHasCommit(){
  show(`<label>Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ</label><br>
    <select id="hasC"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
    <button onclick="saveHasCommit()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveHasCommit(){
  (document.getElementById('hasC').value === 'Ù†Ø¹Ù…') ? askCommitType() : calculate();
}

function askCommitType(){
  show(`<label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…:</label><br>
    <select id="ctype"><option>Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ</option><option>Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©</option><option>Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</option></select><br>
    <button onclick="saveCommitType()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveCommitType(){ curCommit.type = document.getElementById('ctype').value; askCommitAmount(); }
function askCommitAmount(){
  show(`<label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:</label><br>
    <input type="number" id="camt"><br>
    <button onclick="saveCommitAmount()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveCommitAmount(){ curCommit.amount = parseFloat(document.getElementById('camt').value) || 0; askCommitMonths(); }
function askCommitMonths(){
  show(`<label>Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</label><br>
    <input type="range" id="cmon" min="1" max="60" value="12"
     oninput="document.getElementById('cmonVal').innerText=this.value">
    <br><span id="cmonVal">12</span> Ø´Ù‡Ø±<br>
    <button onclick="saveCommitMonths()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveCommitMonths(){
  curCommit.months = parseInt(document.getElementById('cmon').value);
  (curCommit.type === 'Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©') ? askLastPayQ() : finishCommit(0);
}
function askLastPayQ(){
  show(`<label>Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø©ØŸ</label><br>
    <select id="hasLast"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
    <button onclick="saveLastPayQ()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveLastPayQ(){
  (document.getElementById('hasLast').value === 'Ù†Ø¹Ù…') ? askLastPay() : finishCommit(0);
}
function askLastPay(){
  show(`<label>Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©:</label><br>
    <input type="number" id="lastPay"><br>
    <button onclick="saveLastPay()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveLastPay(){ finishCommit(parseFloat(document.getElementById('lastPay').value) || 0); }
function finishCommit(last){ curCommit.lastPayment = last; commitments.push({...curCommit}); curCommit = {}; askMore(); }
function askMore(){
  show(`<label>Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰ØŸ</label><br>
    <select id="more"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
    <button onclick="saveMore()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveMore(){ (document.getElementById('more').value === 'Ù†Ø¹Ù…') ? askCommitType() : calculate(); }

function calculate(){
  const salary = answers.salary;
  const duration = answers.duration;
  const rate = answers.profitMargin;
  const financeType = answers.financeType;
  const supported = answers.supported;
  const bundle = answers.bundle;

  let deductionRate = 0, extraSupport = 0, addCommodity = false;

  const hasCar = commitments.find(c => c.type === 'Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©');
  const hasOther = commitments.find(c => c.type !== 'Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ');

  if(financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'){
    deductionRate = hasCar || hasOther ? 45 : 33.33;
    addCommodity = true;
  }else{
    deductionRate = (supported === 'Ù…Ø¯Ø¹ÙˆÙ…' && bundle === 'Ù†Ø¹Ù…') ? (salary < 15000 ? 55 : 65) : (salary < 15000 ? 55 : 65);
    if(supported === 'Ù…Ø¯Ø¹ÙˆÙ…' && bundle === 'Ù†Ø¹Ù…'){
      extraSupport = salary < 10000 ? 150000 : 100000;
    }
  }

  let allowedInstallment = salary * (deductionRate / 100);
  let personalLimit = salary * 0.3333;

  let available = allowedInstallment;
  let html = `<h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©:</h2>`;

  let monthsWithCommit = 0;

  commitments.forEach(c => {
    let monthly = c.amount;
    if(financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ' && c.type === 'Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && c.lastPayment && duration < 60){
      monthly += c.lastPayment / Math.min(24, duration);
      html += `<p><strong>ØªÙØ¶Ø§Ù ${(c.lastPayment/Math.min(24,duration)).toFixed(0)} Ø±ÙŠØ§Ù„ Ù„Ù…Ø¯Ø© ${Math.min(24,duration)} Ø´Ù‡Ø± Ù„ØªØºØ·ÙŠØ© Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ù„Ù„Ø³ÙŠØ§Ø±Ø©.</strong></p>`;
    }
    available -= monthly;
    monthsWithCommit = Math.max(monthsWithCommit, c.months);
  });

  if(available <= 0){
    show(`<h2>Ø¹Ø°Ø±Ù‹Ø§</h2><p>Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ‚Ø¯ÙŠÙ… ØªÙ…ÙˆÙŠÙ„ Ø­Ø§Ù„ÙŠÙ‹Ø§ Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</p>
    <p>Ù„Ù„ØªÙˆØ§ØµÙ„: 0506214458 - hlooleqrr.com</p>`);
    return;
  }

  const usedForPersonal = Math.min(personalLimit, available);
  const monthsAfter = duration - monthsWithCommit;
  const total1 = usedForPersonal * monthsWithCommit;
  const total2 = usedForPersonal * monthsAfter;
  const totalFinal = total1 + total2;

  const factor = (duration/12)*(rate/100)+1;
  const netFinance = totalFinal / factor;

  let fee = Math.min(netFinance * 0.01, 5000);
  let vat = Math.min(fee * 0.15, 750);
  const commodity = addCommodity ? netFinance * 0.01 : 0;
  const netAfter = netFinance - (fee + vat + commodity);
  const finalAmount = netAfter + extraSupport;

  html += `
    <p><strong>Ù‚Ø³Ø·Ùƒ Ø®Ù„Ø§Ù„ Ø£ÙˆÙ„ ${monthsWithCommit} Ø´Ù‡Ø±:</strong> ${usedForPersonal.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø«Ù… Ø§Ù„Ù‚Ø³Ø·:</strong> ${usedForPersonal.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong> ${totalFinal.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­:</strong> ${factor.toFixed(3)}</p>
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${netFinance.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:</strong> ${fee.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${vat.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    ${addCommodity?`<p><strong>Ø±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹:</strong> ${commodity.toFixed(0)} Ø±ÙŠØ§Ù„</p>`:''}
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> ${netAfter.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    ${extraSupport>0?`<p><strong>Ø¯Ø¹Ù… Ø­ÙƒÙˆÙ…ÙŠ Ù…Ø¶Ø§Ù:</strong> ${extraSupport.toLocaleString()} Ø±ÙŠØ§Ù„</p>`:''}
    <h3>ğŸ“ Ù„Ù„ØªÙˆØ§ØµÙ„: 0506214458 â€“ hlooleqrr.com</h3>`;

  show(html);
}
</script>

<footer>
  <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù€ Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© â€“ <span id="datetime"></span></p>
</footer>

<script>
setInterval(()=>{
  const now = new Date();
  document.getElementById("datetime").innerText =
    now.getFullYear()+'-'+(now.getMonth()+1).toString().padStart(2,'0')+'-'+now.getDate().toString().padStart(2,'0')+
    ' '+now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0')+':'+now.getSeconds().toString().padStart(2,'0');
},1000);
</script>
</body>
</html>