<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ â€“ Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±</title>
  <style>
    body{font-family:'Tajawal',sans-serif;background:#f4f6f8;margin:0;text-align:center}
    header{background:#005c48;color:#fff;padding:20px}
    .container{max-width:600px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1)}
    input,select,button{width:90%;padding:10px;margin:10px 0;font-size:16px;border-radius:5px;border:1px solid #ccc}
    input[type=range]::-webkit-slider-thumb { pointer-events: auto; }
    button{background:#00796b;color:#fff;border:none;cursor:pointer}
    button:hover{background:#004d40}
    footer{font-size:12px;color:#666;margin-top:40px;padding:10px}
    .fade-in{opacity:0;transform:translateY(20px);animation:fadeIn .6s forwards}
    @keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>
<header>
  <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</p>
</header>

<div class="container" id="form-container">
  <div id="question"></div>
  <button onclick="nextQuestion()" id="mainBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
</div>

<script>
let answers = {commitments: []};
let step = 0, commitmentIndex = 0;
const months60 = Array.from({length:60},(_,i)=>i+1);
const months360 = Array.from({length:360},(_,i)=>i+1);

const baseQuestions = [
  {id:'financeType', label:'Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„', type:'select', options:['ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ','ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ']},
  {id:'supported', label:'Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ', type:'select', options:['Ù…Ø¯Ø¹ÙˆÙ…','ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'], show:a=>a.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'},
  {id:'bundle', label:'Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ', type:'select', options:['Ù†Ø¹Ù…','Ù„Ø§'], show:a=>a.supported==='Ù…Ø¯Ø¹ÙˆÙ…'},
  {id:'salary', label:'ÙƒÙ… Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ', type:'number'},
  {id:'months', label:'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ù„Ù„ØªÙ…ÙˆÙŠÙ„', type:'range', min:12, max:360, value:240},
  {id:'profitMargin', label:'Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%)ØŸ', type:'number'},
  {id:'hasCommitments', label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ', type:'select', options:['Ù†Ø¹Ù…','Ù„Ø§']}
];

function showQuestion(){
  const zone = document.getElementById('question');
  zone.innerHTML = '';
  const q = getCurrentQuestion();
  if (!q) { calculate(); document.getElementById('mainBtn').textContent = 'Ø£Ø¹Ø¯ Ø§Ù„Ø­Ø³Ø¨Ø©'; return; }
  if (q.show && !q.show(answers)) { step++; showQuestion(); return; }

  const wrap = document.createElement('div'); wrap.className = 'fade-in';
  wrap.innerHTML = `<label>${q.label}</label><br/>`;
  if (q.type === 'select') {
    const sel = document.createElement('select'); sel.id = q.id;
    q.options.forEach(o => sel.add(new Option(o, o))); wrap.appendChild(sel);
  } else if (q.type === 'range') {
    const input = document.createElement('input');
    input.type = 'range'; input.min = q.min; input.max = q.max; input.step = 1;
    input.value = q.value; input.id = q.id;
    const val = document.createElement('span'); val.id = q.id + 'Val'; val.textContent = q.value;
    input.oninput = () => val.textContent = input.value;
    wrap.append(input, ' ', val, ' Ø´Ù‡Ø±');
  } else {
    const inp = document.createElement('input'); inp.type = 'number'; inp.id = q.id; wrap.appendChild(inp);
  }
  zone.appendChild(wrap);
}

function getCurrentQuestion(){
  if (step < baseQuestions.length) return baseQuestions[step];
  if (answers.hasCommitments === 'Ù†Ø¹Ù…') {
    const c = answers.commitments[commitmentIndex] || {};
    if (!c.type) return {id:'type', type:'select', label:'Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', options:['Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ','Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©','Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ']};
    if (!c.amount) return {id:'amount', type:'number', label:'ÙƒÙ… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ'};
    if (!c.months) return {id:'monthsRemain', type:'select', label:'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©', options:months60.map(m=>m+' Ø´Ù‡Ø±')};
    if (c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && c.months && !c.hasBalloon) return {id:'hasBalloon', type:'select', label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø©ØŸ', options:['Ù†Ø¹Ù…','Ù„Ø§']};
    if (c.hasBalloon==='Ù†Ø¹Ù…' && !c.balloon) return {id:'balloon', type:'number', label:'ÙƒÙ… Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©ØŸ'};
    if (!c.askMore) return {id:'more', type:'select', label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰ØŸ', options:['Ù†Ø¹Ù…','Ù„Ø§']};
  }
  return null;
}

function nextQuestion(){
  const q = getCurrentQuestion(); if (!q) return;
  const val = document.getElementById(q.id)?.value || null;

  if (step < baseQuestions.length) {
    answers[q.id] = q.type === 'number' ? parseFloat(val) : val;
    if (q.id === 'financeType') {
      const mQ = baseQuestions.find(x => x.id === 'months');
      mQ.max = (val === 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ') ? 60 : 360;
      mQ.value = (val === 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ') ? 60 : 240;
    }
    step++;
  } else {
    let c = answers.commitments[commitmentIndex] || {};
    if (!c.type) c.type = val;
    else if (!c.amount) c.amount = parseFloat(val)||0;
    else if (!c.months) c.months = parseInt(val)||0;
    else if (c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && c.months && c.hasBalloon === undefined) c.hasBalloon = val;
    else if (c.hasBalloon==='Ù†Ø¹Ù…' && !c.balloon) c.balloon = parseFloat(val)||0;
    else if (!c.askMore) {
      c.askMore = val;
      if (val === 'Ù†Ø¹Ù…') { commitmentIndex++; answers.commitments.push({}); }
    }
    answers.commitments[commitmentIndex] = c;
  }
  showQuestion();
}

function calculate(){
  const salary = +answers.salary || 0;
  const months = +answers.months || 0;
  const years = months / 12;
  const profit = +answers.profitMargin || 0;
  const type = answers.financeType;

  let maxRate = 0, maxInstall = 0, addCommodity = false, extraSupport = 0;
  if (type === 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ') {
    maxRate = 45;
    maxInstall = salary * 0.3333;
    addCommodity = true;
  } else {
    maxRate = (salary >= 15000 || (answers.supported==='Ù…Ø¯Ø¹ÙˆÙ…' && answers.bundle==='Ù„Ø§')) ? 65 : 55;
    maxInstall = salary * maxRate / 100;
    if (answers.supported==='Ù…Ø¯Ø¹ÙˆÙ…' && answers.bundle==='Ù†Ø¹Ù…') extraSupport = salary<10000 ? 150000 : 100000;
  }

  let timeline = Array(months).fill(0);
  answers.commitments.forEach(c=>{
    for (let i=0; i<c.months; i++) {
      timeline[i] += c.amount || 0;
    }
    if (c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && c.hasBalloon==='Ù†Ø¹Ù…' && c.balloon){
      for(let i=months-24;i<months;i++){
        timeline[i] += (c.balloon/24)||0;
      }
    }
  });

  let newInstall = Array(months).fill(0);
  for (let i=0;i<months;i++) {
    const used = timeline[i] || 0;
    const allowed = type==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'
      ? Math.min(salary*0.45 - used, maxInstall)
      : Math.max(0, salary*maxRate/100 - used);
    newInstall[i] = Math.max(0, allowed);
  }

  const totalWithProfit = newInstall.reduce((sum,v)=>sum+v,0);
  const profitFactor = years * profit / 100 + 1;
  const netFinance = totalWithProfit / profitFactor;

  let admin = netFinance * 0.01, vat = admin * 0.15;
  if (admin+vat > 5750) { admin = 5000; vat = 750; }
  const commodity = addCommodity ? netFinance * 0.01 : 0;
  const finalNet = netFinance - admin - vat - commodity;
  const finalPlus = finalNet + extraSupport;
  const withFeesProfit = totalWithProfit - finalNet;
  const withoutFeesProfit = netFinance * (profitFactor - 1);

  document.getElementById('question').innerHTML = `
    <h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©:</h2>
    <p><strong>Ù‚Ø³Ø·Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª:</strong> ${Math.round(Math.min(...newInstall))} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø«Ù… Ù‚Ø³Ø·Ùƒ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª:</strong> ${Math.round(Math.max(...newInstall))} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong> ${Math.round(totalWithProfit)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­:</strong> ${profitFactor.toFixed(3)}</p>
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${Math.round(netFinance)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:</strong> ${Math.round(admin)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${Math.round(vat)} Ø±ÙŠØ§Ù„</p>
    ${addCommodity?`<p><strong>Ø±Ø³ÙˆÙ… Ø§Ù„Ø³Ù„Ø¹:</strong> ${Math.round(commodity)} Ø±ÙŠØ§Ù„</p>`:''}
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> ${Math.round(finalNet)} Ø±ÙŠØ§Ù„</p>
    ${extraSupport?`<p><strong>Ø¯Ø¹Ù… Ø­ÙƒÙˆÙ…ÙŠ Ù…Ø¶Ø§Ù:</strong> ${extraSupport.toLocaleString()} Ø±ÙŠØ§Ù„</p>`:''}
    <p><strong>Ø§Ù„Ø±Ø¨Ø­ Ø¯ÙˆÙ† Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${Math.round(withoutFeesProfit)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${Math.round(withFeesProfit)} Ø±ÙŠØ§Ù„</p>
    <h3 style="margin-top:20px;">ğŸ“ Ù„Ù„ØªÙˆØ§ØµÙ„: 0506214458 â€“ hlooleqrr.com</h3>
  `;
}

function updateDateTime(){
  const d = new Date();
  document.getElementById('datetime').textContent =
    `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${String(d.getSeconds()).padStart(2,'0')}`;
}
</script>

<footer>
  <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€“ Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© â€“ <span id="datetime"></span></p>
</footer>
<script>setInterval(updateDateTime,1000); updateDateTime();</script>
</body>
</html>