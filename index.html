<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f4f6f8;
      margin: 0;
      text-align: center;
      font-size: 30px;
    }
    header {
      background: #005c48;
      color: #fff;
      padding: 25px;
      font-size: 32px;
    }
    .container {
      max-width: 700px;
      margin: 25px auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,.1);
    }
    input, select, button {
      width: 94%;
      padding: 18px;
      margin: 16px 0;
      font-size: 28px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    select option {
      font-size: 26px;
    }
    button {
      background: #00796b;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #004d40;
    }
    .small-reset {
      font-size: 26px;
      padding: 10px 18px;
      margin-top: 20px;
      background: #e3f2fd;
      color: #1565c0;
      border: none;
      cursor: pointer;
      border-radius: 15px;
    }
    .small-reset:hover {
      background: #bbdefb;
    }
    footer {
      font-size: 24px;
      color: #666;
      margin-top: 40px;
      padding: 15px;
    }
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInMove .6s forwards;
    }
    @keyframes fadeInMove {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .result p {
      margin: 12px 0;
      font-size: 30px;
      line-height: 1.6;
    }
    .result h2, .result h3 {
      font-size: 34px;
    }
    .highlight {
      font-size: 36px;
      font-weight: bold;
      color: #004d40;
    }
    .red-warning {
      color: red;
      font-size: 36px;
      font-weight: bold;
    }
  </style>
</head>
<body>
<header>
  <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</p>
</header>
<div class="container" id="form-container">
  <div id="question"></div>
  <button id="mainButton" onclick="handleStartOrReset()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
  <div id="nextContainer" style="display:none">
    <button onclick="nextQuestion()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
  </div>
  <div id="resetButtonContainer" style="display:none">
    <button class="small-reset" onclick="resetCalc()">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©</button>
  </div>
</div><script>
const militaryRanks = {
  "Ø¬Ù†Ø¯ÙŠ": 44, "Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„": 44, "Ø¹Ø±ÙŠÙ": 46, "ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨": 48,
  "Ø±Ù‚ÙŠØ¨": 50, "Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„": 50, "Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡": 52,
  "Ù…Ù„Ø§Ø²Ù…": 44, "Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„": 44, "Ù†Ù‚ÙŠØ¨": 48, "Ø±Ø§Ø¦Ø¯": 50,
  "Ù…Ù‚Ø¯Ù…": 52, "Ø¹Ù‚ÙŠØ¯": 54, "Ø¹Ù…ÙŠØ¯": 56, "Ù„ÙˆØ§Ø¡": 58
};

function hijriToGregorianYear(hijriDate) {
  const [y, m, d] = hijriDate.replace('Ù‡Ù€','').trim().split('/').map(x => parseInt(x));
  const estimatedYear = y + 622 - Math.floor(y / 33); 
  const current = new Date();
  return current.getFullYear() - estimatedYear;
}

function getMaxMonths(age, type, rank = null) {
  if (type === "Ø¹Ø³ÙƒØ±ÙŠ" && militaryRanks[rank]) {
    return Math.max((militaryRanks[rank] - age) * 12, 0);
  } else {
    return Math.max((60 - age) * 12, 0);
  }
}

function convertMonthsToText(months) {
  const years = Math.floor(months / 12);
  const rem = months % 12;
  let yTxt = years > 0 ? `${convertNumberToArabicText(years)} Ø³Ù†Ø©` : '';
  let mTxt = rem > 0 ? `${convertNumberToArabicText(rem)} Ø´Ù‡Ø±` : '';
  return [yTxt, mTxt].filter(Boolean).join(' Ùˆ');
}

function convertNumberToArabicText(n) {
  const units = ["", "ÙˆØ§Ø­Ø¯", "Ø§Ø«Ù†ÙŠÙ†", "Ø«Ù„Ø§Ø«Ø©", "Ø£Ø±Ø¨Ø¹Ø©", "Ø®Ù…Ø³Ø©", "Ø³ØªØ©", "Ø³Ø¨Ø¹Ø©", "Ø«Ù…Ø§Ù†ÙŠØ©", "ØªØ³Ø¹Ø©"];
  const tens = ["", "", "Ø¹Ø´Ø±ÙˆÙ†", "Ø«Ù„Ø§Ø«ÙˆÙ†", "Ø£Ø±Ø¨Ø¹ÙˆÙ†", "Ø®Ù…Ø³ÙˆÙ†", "Ø³ØªÙˆÙ†"];
  if (n <= 9) return units[n];
  if (n === 10) return "Ø¹Ø´Ø±Ø©";
  if (n < 20) return `${units[n % 10]} Ø¹Ø´Ø±`;
  if (n % 10 === 0) return tens[n / 10];
  return `${units[n % 10]} Ùˆ${tens[Math.floor(n / 10)]}`;
}

let answers = {}, step = 0;

const generalQuestions = [
  { id:'financeType',label:'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„:',type:'select',options:['ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ Ø£Ùˆ ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ','ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'] },
  { id:'jobType',label:'Ù…Ø§ Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©ØŸ',type:'select',options:['Ø¹Ø³ÙƒØ±ÙŠ','Ù…Ø¯Ù†ÙŠ','Ù‚Ø·Ø§Ø¹ Ø®Ø§Øµ Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ','Ù‚Ø·Ø§Ø¹ Ø®Ø§Øµ Ù…Ø¹ØªÙ…Ø¯ Ù„Ø¯Ù‰ Ø§Ù„Ø¨Ù†Ùƒ','Ù‚Ø·Ø§Ø¹ Ø®Ø§Øµ ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯'] },
  { id:'birthDate',label:'Ù…Ø§ ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯ÙƒØŸ (Ù‡Ø¬Ø±ÙŠ)',type:'text',placeholder:'Ù…Ø«Ø§Ù„: 1400/07/01Ù‡Ù€' },
  { id:'rank',label:'Ø§Ø°ÙƒØ± Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©',type:'select',options:Object.keys(militaryRanks),show:a=>a.jobType==='Ø¹Ø³ÙƒØ±ÙŠ' },
  { id:'salary',label:'ÙƒÙ… Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„ØµØ§ÙÙŠØŸ',type:'number' },
  { id:'months',label:'Ø¹Ù„Ù‰ ÙƒÙ… Ø´Ù‡Ø± ØªØ±ÙŠØ¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ØŸ',type:'select',options:[],dynamic:true },
  { id:'profitMargin',label:'Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%)ØŸ',type:'number' }
];<script>
function handleStartOrReset(){
  if(!hasStarted){
    hasStarted = true;
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    showQuestion();
  } else { resetCalc(); }
}

function resetCalc(){
  answers = {};
  step = 0;
  hasStarted = true;
  document.getElementById('mainButton').style.display = 'none';
  document.getElementById('resetButtonContainer').style.display = 'block';
  showQuestion();
}

function showQuestion(){
  const cont = document.getElementById('question');
  cont.innerHTML = '';
  document.getElementById('nextContainer').style.display = 'block';
  let q;
  while(step < generalQuestions.length){
    q = generalQuestions[step];
    if(q.show && !q.show(answers)){ step++; continue; }
    break;
  }
  if(!q){ document.getElementById('nextContainer').style.display = 'none'; calculate(); return; }

  const div = document.createElement('div'); div.classList.add('fade-in');
  div.innerHTML = `<label>${q.label}</label><br>`;
  if(q.type==='select'){
    const sel = document.createElement('select'); sel.id = q.id;
    sel.innerHTML = '<option value="">Ø§Ø®ØªØ±...</option>';
    if(q.dynamic && q.id==='months'){
      const age = hijriToGregorianYear(answers.birthDate || "1400/07/01");
      const maxMonths = getMaxMonths(age, answers.jobType, answers.rank);
      for(let i=1; i<=maxMonths; i++){
        const text = `${i} Ø´Ù‡Ø±${i>1?' â€“ '+convertMonthsToText(i):''}`;
        sel.innerHTML += `<option value="${i}">${text}</option>`;
      }
    } else {
      q.options.forEach(opt=>{ sel.innerHTML += `<option value="${opt}">${opt}</option>`; });
    }
    div.appendChild(sel);
  }else{
    const inp = document.createElement('input');
    inp.type = q.type || 'text'; inp.id = q.id;
    if(q.placeholder) inp.placeholder = q.placeholder;
    div.appendChild(inp);
  }
  cont.appendChild(div);
}

function nextQuestion(){
  const q = generalQuestions[step];
  const el = document.getElementById(q.id);
  const val = el?.value?.trim();
  if(!val){ alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©'); return; }
  answers[q.id] = val;
  step++;
  showQuestion();
}
</script><script>
function calculate(){
  const salary = parseFloat(answers.salary);
  const months = parseInt(answers.months);
  const years = months / 12;
  const profitMargin = parseFloat(answers.profitMargin);

  let deductionRate = 65;
  if(answers.financeType.includes('Ø´Ø®ØµÙŠ')) deductionRate = 45;

  const allowedInst = salary * (deductionRate / 100);
  const totalInst = allowedInst * months;
  const profitFactor = (years * profitMargin / 100) + 1;
  const netFinance = totalInst / profitFactor;

  let adminFee = netFinance * 0.01, vat = adminFee * 0.15;
  if(adminFee + vat > 5750){ adminFee = 5000; vat = 750; }
  const finalNet = netFinance - (adminFee + vat);
  const totalProfit = totalInst - finalNet;

  const resultDiv = document.createElement('div');
  resultDiv.classList.add('result');
  let html = '<h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø© (Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©):</h2>';

  if (allowedInst <= 0 || netFinance <= 0) {
    html += `<p class="red-warning">âŒ Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ…ÙˆÙŠÙ„Ùƒ</p>`;
  }

  const toText = n => {
    const parts = n.toFixed(4).split(".");
    const main = parseInt(parts[0]).toLocaleString();
    const halalah = parseInt(parts[1]) > 0 ? `${parseInt(parts[1])} Ù‡Ù„Ø§Ù„Ø§Øª` : '';
    return [main, halalah].filter(Boolean).join('.');
  };

  const arabicText = n => {
    const riyals = Math.floor(n);
    const parts = riyals.toLocaleString() + ' Ø±ÙŠØ§Ù„';
    const dec = Math.round((n - riyals) * 10000);
    const halalahText = dec > 0 ? `${convertNumberToArabicText(dec)} Ù‡Ù„Ø§Ù„Ø§Øª` : '';
    return [parts, halalahText].filter(Boolean).join(' Ùˆ');
  };

  html += `
    <p><strong>Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:</strong> ${allowedInst.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p style="font-size: 32px; color: #004d40; font-weight: bold;">Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${months} Ø´Ù‡Ø± â€“ ${convertMonthsToText(months)}</p>
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${toText(finalNet)}<br>(${arabicText(finalNet)})</p>
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${toText(netFinance)}<br>(${arabicText(netFinance)})</p>
    <p><strong>Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${toText(totalProfit)}<br>(${arabicText(totalProfit)})</p>
    <p><strong>Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:</strong> ${adminFee.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©:</strong> ${vat.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong> ${totalInst.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <h3 style="margin-top:30px;">ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 0506214458 | Ø§Ù„Ù…ÙˆÙ‚Ø¹: hlooleqrr.com</h3>
  `;
  document.getElementById('question').innerHTML = html;
}
</script>
</body>
</html>
</script>