<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ - Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±</title>
  <style>
    body{font-family:'Tajawal',sans-serif;background:#f4f6f8;margin:0;text-align:center}
    header{background:#005c48;color:#fff;padding:20px}
    .container{max-width:600px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1)}
    input,select,button{width:90%;padding:10px;margin:10px 0;font-size:16px;border-radius:5px;border:1px solid #ccc}
    button{background:#00796b;color:#fff;border:none;cursor:pointer}
    button:hover{background:#004d40}
    .small-reset{font-size:14px;padding:6px 12px;margin-top:20px;background:#e0e0e0;color:#333;border:none;cursor:pointer;border-radius:20px}
    .small-reset:hover{background:#ccc}
    footer{font-size:12px;color:#666;margin-top:40px;padding:10px}
    .fade-in{opacity:0;transform:translateY(20px);animation:fadeInMove .6s forwards}
    @keyframes fadeInMove{to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>
<header>
  <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</p>
</header>

<div class="container" id="form-container">
  <div id="question"></div>
  <button id="mainButton" onclick="handleStartOrReset()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
  <div id="nextContainer" style="display:none">
    <button onclick="nextQuestion()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
  </div>
</div>
<script>
let answers = { commitments: [] }, step = 0, commitmentStep = 0, currentCommitment = {};
let hasStarted = false;

const generalQuestions = [
  { id:'financeType',label:'Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„',type:'select',options:['ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ','ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'] },
  { id:'supported',label:'Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ',type:'select',options:['Ù…Ø¯Ø¹ÙˆÙ…','ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'],show:a=>a.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' },
  { id:'bundle',label:'Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'],show:a=>a.supported==='Ù…Ø¯Ø¹ÙˆÙ…' },
  { id:'salary',label:'ÙƒÙ… Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ',type:'number' },
  { id:'months',label:'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ù„Ù„ØªÙ…ÙˆÙŠÙ„',type:'range',min:12,max:360,value:240 },
  { id:'profitMargin',label:'Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%)ØŸ',type:'number' },
  { id:'hasCommitments',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'] }
];

const commitmentQuestions = [
  { id:'type',label:'Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…',type:'select',options:['Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ','Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©','Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ'] },
  { id:'amount',label:'ÙƒÙ… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ',type:'number' },
  { id:'months',label:'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©ØŸ',type:'select',options:Array.from({length:60},(_,i)=>(i+1)+' Ø´Ù‡Ø±') },
  { id:'balloon',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø©ØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'],show:c=>c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' },
  { id:'balloonAmount',label:'ÙƒÙ… Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©ØŸ',type:'number',show:c=>c.balloon==='Ù†Ø¹Ù…' },
  { id:'more',label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰ØŸ',type:'select',options:['Ù†Ø¹Ù…','Ù„Ø§'] }
];

function handleStartOrReset(){
  if(!hasStarted){
    hasStarted = true;
    document.getElementById('mainButton').textContent = 'ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©';
    showQuestion();
  }else{
    resetCalc();
  }
}
function resetCalc(){
  answers = { commitments: [] };
  step = commitmentStep = 0;
  currentCommitment = {};
  hasStarted = true;
  document.getElementById('mainButton').textContent = 'ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©';
  showQuestion();
}
function showQuestion(){
  const cont = document.getElementById('question');
  cont.innerHTML = '';
  document.getElementById('nextContainer').style.display = 'block';
  let q;
  if(step < generalQuestions.length){
    q = generalQuestions[step];
    if(q.show && !q.show(answers)){ step++; showQuestion(); return; }
  }else if(answers.hasCommitments === 'Ù†Ø¹Ù…'){
    q = commitmentQuestions[commitmentStep];
    if(q.show && !q.show(currentCommitment)){ commitmentStep++; showQuestion(); return; }
  }else{
    document.getElementById('nextContainer').style.display = 'none';
    calculate(); return;
  }
  const div = document.createElement('div'); div.classList.add('fade-in');
  div.innerHTML = `<label>${q.label}</label><br>`;
  if(q.type==='select'){
    const sel = document.createElement('select'); sel.id = q.id;
    q.options.forEach(opt=>{ sel.innerHTML += `<option value="${opt}">${opt}</option>`; });
    div.appendChild(sel);
  }else if(q.type==='range'){
    div.innerHTML += `<input type="range" id="${q.id}" min="${q.min}" max="${q.max}" value="${q.value}"
                       oninput="document.getElementById('${q.id}Val').textContent=this.value">
                      <br><span id="${q.id}Val">${q.value}</span> Ø´Ù‡Ø±`;
  }else{
    div.innerHTML += `<input type="number" id="${q.id}">`;
  }
  cont.appendChild(div);
}