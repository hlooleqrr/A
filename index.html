<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± â€“ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„</title>
<style>
body{font-family:'Tajawal',sans-serif;background:#f4f6f8;margin:0;text-align:center}
header{background:#005c48;color:#fff;padding:24px 10px}
.container{max-width:600px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1)}
input,select,button{width:90%;padding:10px;margin:10px 0;font-size:16px;border-radius:5px;border:1px solid #ccc}
button{background:#00796b;color:#fff;border:none;cursor:pointer}
button:hover{background:#004d40}
footer{font-size:12px;color:#666;margin-top:40px;padding:10px}
.fade-in{opacity:0;transform:translateY(20px);animation:fadeIn .4s forwards}
@keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<header>
  <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</p>
</header>

<div class="container" id="form">
  <button id="startBtn" onclick="start()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
  <div id="question"></div>
</div>

<!--------------------  JavaScript  --------------------->
<script>
/* Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© */
let answers={},commitments=[],curCommit={};

/* Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø³Ø¤Ø§Ù„ */
function show(html){
  document.getElementById('question').innerHTML='<div class="fade-in">'+html+'</div>';
  document.getElementById('startBtn').innerText='Ø£Ø¹Ø¯ Ø§Ù„Ø­Ø³Ø¨Ø©';
}

/* Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
function start(){ answers={};commitments=[];askFinanceType(); }

/* Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
function askFinanceType(){
  show(`<label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„:</label><br>
        <select id="ft"><option>ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option><option>ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ</option></select><br>
        <button onclick="() => {}"></button>
        <button onclick="saveFinanceType()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveFinanceType(){
  answers.financeType=document.getElementById('ft').value;
  answers.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'?askSupport():askSalary();
}
function askSupport(){
  show(`<label>Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ</label><br>
        <select id="sup"><option>Ù…Ø¯Ø¹ÙˆÙ…</option><option>ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…</option></select><br>
        <button onclick="saveSupport()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveSupport(){ answers.supported=document.getElementById('sup').value; askBundle(); }
function askBundle(){
  show(`<label>Ù‡Ù„ ØªØ±ØºØ¨ Ø¨Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù‘Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ</label><br>
        <select id="bun"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
        <button onclick="saveBundle()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveBundle(){ answers.bundle=document.getElementById('bun').value; askSalary(); }
function askSalary(){
  show(`<label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±ÙŠØ§Ù„):</label><br>
        <input type="number" id="sal"><br>
        <button onclick="saveSalary()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveSalary(){ answers.salary=parseFloat(document.getElementById('sal').value)||0; askProfit(); }
function askProfit(){
  show(`<label>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%):</label><br>
        <input type="number" id="pr" value="3"><br>
        <button onclick="saveProfit()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveProfit(){ answers.profitMargin=parseFloat(document.getElementById('pr').value)||0; askDuration(); }
function askDuration(){
  const max=answers.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'?60:360;
  const def=answers.financeType==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'?60:240;
  show(`<label>Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø£Ø´Ù‡Ø±):</label><br>
        <input type="range" id="dur" min="12" max="${max}" value="${def}"
               oninput="document.getElementById('dVal').innerText=this.value">
        <br><span id="dVal">${def}</span> Ø´Ù‡Ø±<br>
        <button onclick="saveDuration()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveDuration(){ answers.duration=parseInt(document.getElementById('dur').value); askHasCommit(); }
function askHasCommit(){
  show(`<label>Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ</label><br>
        <select id="has"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
        <button onclick="saveHasCommit()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveHasCommit(){ document.getElementById('has').value==='Ù†Ø¹Ù…'?askCommitType():calculate(); }

/* Ø³Ù„Ø³Ù„Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªØ²Ø§Ù… */
function askCommitType(){
  show(`<label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…:</label><br>
        <select id="ctype"><option>Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ</option><option>Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©</option><option>Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</option></select><br>
        <button onclick="saveCommitType()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveCommitType(){ curCommit.type=document.getElementById('ctype').value; askCommitAmount(); }
function askCommitAmount(){
  show(`<label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:</label><br>
        <input type="number" id="camt"><br>
        <button onclick="saveCommitAmount()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveCommitAmount(){ curCommit.amount=parseFloat(document.getElementById('camt').value)||0; askCommitMonths(); }
function askCommitMonths(){
  show(`<label>Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</label><br>
        <input type="range" id="cmon" min="1" max="60" value="12"
               oninput="document.getElementById('cmonVal').innerText=this.value">
        <br><span id="cmonVal">12</span> Ø´Ù‡Ø±<br>
        <button onclick="saveCommitMonths()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveCommitMonths(){
  curCommit.months=parseInt(document.getElementById('cmon').value);
  curCommit.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©'?askLastPayQ():finishCommit(0);
}
function askLastPayQ(){
  show(`<label>Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø©ØŸ</label><br>
        <select id="hasLast"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
        <button onclick="saveLastPayQ()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveLastPayQ(){ document.getElementById('hasLast').value==='Ù†Ø¹Ù…'?askLastPay():finishCommit(0); }
function askLastPay(){
  show(`<label>Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©:</label><br>
        <input type="number" id="last"><br>
        <button onclick="saveLastPay()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveLastPay(){ finishCommit(parseFloat(document.getElementById('last').value)||0); }
function finishCommit(last){ curCommit.lastPayment=last; commitments.push({...curCommit}); curCommit={}; askMore(); }
function askMore(){
  show(`<label>Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰ØŸ</label><br>
        <select id="more"><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select><br>
        <button onclick="saveMore()">Ø§Ù„ØªØ§Ù„ÙŠ</button>`);
}
function saveMore(){ document.getElementById('more').value==='Ù†Ø¹Ù…'?askCommitType():calculate(); }

/* Ø­Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ */
function calculate(){
  const S=answers.salary, dur=answers.duration, rate=answers.profitMargin;
  const type=answers.financeType;
  /* Ø­Ø¯ Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ */
  let maxDed= type==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ' && commitments.length?0.45: (type==='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'?0.3333:(S<15000?0.55:0.65));
  let allowed = S*maxDed;
  /* Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø´Ù‡Ø±ÙŠØ© Ø£Ø³Ø§Ø³ÙŠØ© */
  let monthsTimeline=[{m:dur,commit:0}]; // Ø³Ù†Ø¨Ù†ÙŠ Ø¬Ø¯ÙˆÙ„ Ø¨Ø³ÙŠØ· Ù„Ù„ÙØªØ±Ø§Øª Ø§Ù„Ù…ØªØºÙŠØ±Ø©
  commitments.forEach(c=>{
    /* Ø£Ø¶Ù Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªÙŠ ÙŠØºØ·ÙŠÙ‡Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… */
    addTimeline(c.months,c.amount);
    if(c.type==='Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©'&&c.lastPayment){ // Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø© ØªÙˆØ²Ø¹
      const extra=c.lastPayment/24;
      const start= Math.min(dur-24, c.months);
      addTimeline(24,extra,start);
    }
  });
  /* Ø§Ù„Ø¢Ù† Ø§Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ ÙÙŠ ÙƒÙ„ ÙØªØ±Ø© */
  let htmlRes='<h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©:</h2>', total=0;
  let personalCap=S*0.3333;
  monthsTimeline.forEach(seg=>{
    const commit=seg.commit;
    let personal= Math.min(Math.max(allowed-commit,0),personalCap);
    if(type!=='ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ'){ personal = allowed-commit; }
    total += personal*seg.m;
    htmlRes += `<p><strong>Ù‚Ø³Ø· Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù„Ù…Ø¯Ø© ${seg.m} Ø´Ù‡Ø±:</strong> ${personal.toFixed(0)} Ø±ÙŠØ§Ù„ (Ù…Ø¹ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ${commit.toFixed(0)})</p>`;
  });
  /* Ø£Ø±Ø¨Ø§Ø­ ÙˆØ¹ÙˆØ§Ù…Ù„ */
  const factor=(dur/12)*(rate/100)+1;
  const netFinance= total/factor;
  let fee=Math.min(5000, netFinance*0.01);
  let vat=Math.min(750, fee*0.15);
  const netAfter=netFinance-(fee+vat);
  htmlRes += `
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${netFinance.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${netAfter.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­:</strong> ${factor.toFixed(3)}</p>
    <p><strong>Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:</strong> ${fee.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <p><strong>Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> ${vat.toFixed(0)} Ø±ÙŠØ§Ù„</p>
    <h3>ğŸ“ Ù„Ù„ØªÙˆØ§ØµÙ„: 0506214458 â€“ hlooleqrr.com</h3>`;
  show(htmlRes);

  /* ÙˆØ¸ÙŠÙØ© ØªØ³Ø§Ø¹Ø¯Ù†Ø§ Ø¹Ù„Ù‰ Ø¨Ù†Ø§Ø¡timeline */
  function addTimeline(m,amt,start=0){
    if(m<=0) return;
    /* Ù‚Øµ Ø§Ù„ÙØªØ±Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© */
    let acc=0;
    for(let i=0;i<monthsTimeline.length;i++){
      const seg=monthsTimeline[i];
      const segStart=acc, segEnd=acc+seg.m;
      if(start>=segEnd){ acc=segEnd; continue; }
      const applyMonths=Math.min(segEnd, start+m)-Math.max(segStart,start);
      if(applyMonths<=0){ acc=segEnd;continue; }
      /* Ù‚Ø³Ù… Ø§Ù„ÙØªØ±Ø© Ø¥Ù† Ù„Ø²Ù… */
      const before=Math.max(0,start-segStart);
      const middle=applyMonths;
      const after=seg.m-before-middle;
      monthsTimeline.splice(i,1);
      if(after>0) monthsTimeline.splice(i,0,{m:after,commit:seg.commit});
      monthsTimeline.splice(i,0,{m:middle,commit:seg.commit+amt});
      if(before>0) monthsTimeline.splice(i,0,{m:before,commit:seg.commit});
      break;
    }
  }
}
</script>

<footer>
  <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù€ Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© â€“ <span id="datetime"></span></p>
</footer>
<script>
setInterval(()=>{
  const d=new Date();
  document.getElementById('datetime').innerText=
    d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0')+' '+
    String(d.getHours()).padStart(2,'0')+':'+String(d.getMinutes()).padStart(2,'0')+':'+String(d.getSeconds()).padStart(2,'0');
},1000);
</script>
</body>
</html>