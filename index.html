<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>سرعة تملك العقار - حاسبة التمويل</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      background-color: #005c48;
      color: white;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    input, select, button {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #00796b;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #004d40;
    }
    footer {
      font-size: 12px;
      color: #666;
      margin-top: 40px;
      padding: 10px;
    }
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInMove 0.6s forwards;
    }
    @keyframes fadeInMove {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
<header>
  <h1>سرعة تملك العقار والحلول التمويلية</h1>
  <p>حاسبة التمويل التقريبية</p>
</header>
<div class="container" id="form-container">
  <div id="question"></div>
  <button onclick="nextQuestion()">ابدأ الحسبة</button>
</div>
<footer>
  <p>جميع الحقوق محفوظة - سرعة تملك العقار والحلول التمويلية - <span id="datetime"></span></p>
</footer>
<script>
function updateDateTime() {
  const now = new Date();
  document.getElementById('datetime').innerText =
    `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
}
setInterval(updateDateTime, 1000);
updateDateTime();
</script>
<script>

let answers = {};
let commitments = [];

function nextQuestion() {
  askFinanceType();
}


function askFinanceType() {
  showQuestion(`
    <label>نوع التمويل:</label><br>
    <select id="financeType">
      <option value="تمويل عقاري">تمويل عقاري</option>
      <option value="تمويل شخصي">تمويل شخصي</option>
    </select>
    <br><button onclick="saveFinanceType()">التالي</button>
  `);
}


function showQuestion(html) {
  const q = document.getElementById('question');
  q.innerHTML = `<div class="fade-in">${html}</div>`;
}


function saveFinanceType() {
  const ft = document.getElementById('financeType').value;
  answers.financeType = ft;
  if (ft === 'تمويل عقاري') {
    askSupported();
  } else {
    askSalary();
  }
}


function askSupported() {
  showQuestion(`
    <label>هل التمويل مدعوم؟</label><br>
    <select id="supported">
      <option value="مدعوم">مدعوم</option>
      <option value="غير مدعوم">غير مدعوم</option>
    </select>
    <br><button onclick="saveSupported()">التالي</button>
  `);
}


function saveSupported() {
  answers.supported = document.getElementById('supported').value;
  if (answers.supported === 'مدعوم') {
    askBundle();
  } else {
    askSalary();
  }
}


function askBundle() {
  showQuestion(`
    <label>هل ترغب في الحصول على دفعة مقدمة من سكني؟</label><br>
    <select id="bundle">
      <option value="نعم">نعم</option>
      <option value="لا">لا</option>
    </select>
    <br><button onclick="saveBundle()">التالي</button>
  `);
}


function saveBundle() {
  answers.bundle = document.getElementById('bundle').value;
  askSalary();
}


function askSalary() {
  showQuestion(`
    <label>كم الراتب الشهري؟</label><br>
    <input type="number" id="salary">
    <br><button onclick="saveSalary()">التالي</button>
  `);
}


function saveSalary() {
  answers.salary = parseFloat(document.getElementById('salary').value) || 0;
  askMonths();
}
  || 0;
  commitments.push(currentCommitment);
  askMoreCommitments();
}

function askMoreCommitments() {
  showQuestion(`
    <label>هل لديك التزامات أخرى؟</label><br>
    <select id="moreCommitments">
      <option value="نعم">نعم</option>
      <option value="لا">لا</option>
    </select>
    <br><button onclick="saveMoreCommitments()">التالي</button>
  `);
}

function saveMoreCommitments() {
  const more = document.getElementById('moreCommitments').value;
  if (more === 'نعم') {
    askCommitmentType();
  } else {
    calculateResult();
  }
}

// سيتم توليد منطق JavaScript الكامل هنا لاحقًا
</script>


</body>
</html>

<script>
function calculateResult() {
  const financeType = answers.financeType;
  const supported = answers.supported;
  const bundle = answers.bundle;
  const salary = answers.salary;
  const months = financeType === "تمويل شخصي" ? 60 : 360;

  let profitMargin = 6;
  let deductionRate = 0;
  let extraSupport = 0;
  let addCommodityFee = financeType === "تمويل شخصي";

  if (financeType === "تمويل عقاري") {
    if (supported === "مدعوم") {
      if (bundle === "نعم") {
        extraSupport = salary < 10000 ? 150000 : 100000;
        deductionRate = salary < 15000 ? 55 : 65;
      } else {
        deductionRate = salary < 15000 ? 55 : 65;
      }
    } else {
      deductionRate = salary < 15000 ? 55 : 65;
    }
  } else {
    deductionRate = 33.33;
  }

  let totalCommitment = 0;
  commitments.forEach(c => {
    let total = c.amount * c.months;
    if (c.type === "قرض سيارة" && c.lastPayment > 0) {
      total += c.lastPayment;
    }
    totalCommitment += total;
  });

  const allowedInstallment = (salary * (deductionRate / 100));
  let availableInstallment = allowedInstallment;

  commitments.forEach(c => {
    availableInstallment -= c.amount;
  });

  if (availableInstallment <= 0) {
    document.getElementById("question").innerHTML = `
      <h2>عذرًا</h2>
      <p>لا يمكنك الحصول على تمويل حاليًا بسبب الالتزامات القائمة.</p>
      <h3>للتواصل مع سرعة تملك العقار</h3>
      <p>0506214458 - hlooleqrr.com</p>
    `;
    return;
  }

  const monthsWithCommitment = Math.max(...commitments.map(c => c.months), 0);
  const monthsWithoutCommitment = months - monthsWithCommitment;

  const totalWithCommitment = availableInstallment * monthsWithCommitment;
  const totalWithoutCommitment = allowedInstallment * monthsWithoutCommitment;
  const totalInstallments = totalWithCommitment + totalWithoutCommitment;

  const profitFactor = (months / 12) * (profitMargin / 100) + 1;
  const netFinance = totalInstallments / profitFactor;

  let adminFee = netFinance * 0.01;
  if (adminFee > 5000) adminFee = 5000;
  let vat = adminFee * 0.15;
  if (vat > 750) vat = 750;

  const commodityFee = addCommodityFee ? netFinance * 0.01 : 0;
  const finalNetFinance = netFinance - adminFee - vat - commodityFee;
  const totalFinal = finalNetFinance + extraSupport;

  document.getElementById("question").innerHTML = `
    <h2>نتيجة الحاسبة:</h2>
    <p>قسطك في أول ${monthsWithCommitment} شهر: ${availableInstallment.toFixed(0)} ريال</p>
    <p>ثم القسط بعد سداد الالتزامات: ${allowedInstallment.toFixed(0)} ريال</p>
    <p>إجمالي التمويل بالأرباح: ${totalInstallments.toFixed(0)} ريال</p>
    <p>التمويل الصافي قبل الرسوم: ${netFinance.toFixed(0)} ريال</p>
    <p>الرسوم الإدارية: ${adminFee.toFixed(0)} ريال</p>
    <p>الضريبة على الرسوم: ${vat.toFixed(0)} ريال</p>
    ${addCommodityFee ? `<p>رسوم السلع: ${commodityFee.toFixed(0)} ريال</p>` : ''}
    <p>التمويل النهائي بعد الرسوم: ${finalNetFinance.toFixed(0)} ريال</p>
    ${extraSupport ? `<p>الدعم الإضافي: ${extraSupport.toLocaleString()} ريال</p>` : ''}
    <h3>للتواصل: 0506214458 - hlooleqrr.com</h3>
  `;
}
</script>