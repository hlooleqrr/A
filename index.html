<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>سرعة تملك العقار – حاسبة التمويل</title>
  <style>
    body{font-family:'Tajawal',sans-serif;background:#f4f6f8;margin:0;text-align:center}
    header{background:#005c48;color:#fff;padding:24px 10px}
    .container{max-width:600px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1)}
    input,select,button{width:90%;padding:10px;margin:10px 0;font-size:16px;border-radius:5px;border:1px solid #ccc}
    button{background:#00796b;color:#fff;border:none;cursor:pointer}
    button:hover{background:#004d40}
    footer{font-size:12px;color:#666;margin-top:40px;padding:10px}
    .fade-in{opacity:0;transform:translateY(20px);animation:fadeIn .5s forwards}
    @keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>
<header>
  <h1>سرعة تملك العقار والحلول التمويلية</h1>
  <p>حاسبة التمويل التقريبية</p>
</header>
<div class="container" id="form">
  <button id="startBtn" onclick="start()">ابدأ الحاسبة</button>
  <div id="question"></div>
</div>

<script>
let answers={}, commitments=[], curCommit={};

function show(html){ document.getElementById('question').innerHTML = '<div class="fade-in">'+html+'</div>'; }
function start(){
  document.getElementById("startBtn").innerText = "أعد الحسبة";
  answers = {}; commitments = []; curCommit = {};
  askFinanceType();
}

function askFinanceType(){
  show(`<label>نوع التمويل:</label><br>
    <select id="ft"><option>تمويل عقاري</option><option>تمويل شخصي</option></select><br>
    <button onclick="saveFinanceType()">التالي</button>`);
}
function saveFinanceType(){
  answers.financeType = document.getElementById('ft').value;
  (answers.financeType === 'تمويل عقاري') ? askSupport() : askSalary();
}
function askSupport(){
  show(`<label>هل التمويل مدعوم؟</label><br>
    <select id="sup"><option>مدعوم</option><option>غير مدعوم</option></select><br>
    <button onclick="saveSupport()">التالي</button>`);
}
function saveSupport(){
  answers.supported = document.getElementById('sup').value;
  (answers.supported === 'مدعوم') ? askBundle() : askSalary();
}
function askBundle(){
  show(`<label>هل ترغب بدفعة مقدّمة من سكني؟</label><br>
    <select id="bun"><option>نعم</option><option>لا</option></select><br>
    <button onclick="saveBundle()">التالي</button>`);
}
function saveBundle(){ answers.bundle = document.getElementById('bun').value; askSalary(); }
function askSalary(){
  show(`<label>الراتب الشهري (ريال):</label><br>
    <input type="number" id="sal"><br>
    <button onclick="saveSalary()">التالي</button>`);
}
function saveSalary(){ answers.salary = parseFloat(document.getElementById('sal').value) || 0; askProfit(); }
function askProfit(){
  show(`<label>هامش الربح السنوي (%):</label><br>
    <input type="number" id="pr"><br>
    <button onclick="saveProfit()">التالي</button>`);
}
function saveProfit(){ answers.profitMargin = parseFloat(document.getElementById('pr').value) || 0; askDuration(); }
function askDuration(){
  const max = answers.financeType === 'تمويل شخصي' ? 60 : 360;
  const defaultVal = 240;
  show(`<label>مدة التمويل (أشهر):</label><br>
    <select id="dur">
      ${Array.from({length: max - 11}, (_, i) => {
        const val = i + 12;
        return `<option value="${val}" ${val === defaultVal ? "selected" : ""}>${val} شهر</option>`;
      }).join('')}
    </select><br>
    <button onclick="saveDuration()">التالي</button>`);
}
function saveDuration(){ answers.duration = parseInt(document.getElementById('dur').value); askHasCommit(); }

function askHasCommit(){
  show(`<label>هل لديك التزامات؟</label><br>
    <select id="hasC"><option>نعم</option><option>لا</option></select><br>
    <button onclick="saveHasCommit()">التالي</button>`);
}
function saveHasCommit(){
  (document.getElementById('hasC').value === 'نعم') ? askCommitType() : calculate();
}

function askCommitType(){
  show(`<label>نوع الالتزام:</label><br>
    <select id="ctype"><option>قرض شخصي</option><option>قرض سيارة</option><option>قرض استهلاكي</option></select><br>
    <button onclick="saveCommitType()">التالي</button>`);
}
function saveCommitType(){ curCommit.type = document.getElementById('ctype').value; askCommitAmount(); }
function askCommitAmount(){
  show(`<label>قيمة القسط الشهري:</label><br>
    <input type="number" id="camt"><br>
    <button onclick="saveCommitAmount()">التالي</button>`);
}
function saveCommitAmount(){ curCommit.amount = parseFloat(document.getElementById('camt').value) || 0; askCommitMonths(); }
function askCommitMonths(){
  show(`<label>الأشهر المتبقية:</label><br>
    <input type="range" id="cmon" min="1" max="60" value="12"
     oninput="document.getElementById('cmonVal').innerText=this.value">
    <br><span id="cmonVal">12</span> شهر<br>
    <button onclick="saveCommitMonths()">التالي</button>`);
}
function saveCommitMonths(){
  curCommit.months = parseInt(document.getElementById('cmon').value);
  (curCommit.type === 'قرض سيارة') ? askLastPayQ() : finishCommit(0);
}
function askLastPayQ(){
  show(`<label>هل لديك دفعة أخيرة؟</label><br>
    <select id="hasLast"><option>نعم</option><option>لا</option></select><br>
    <button onclick="saveLastPayQ()">التالي</button>`);
}
function saveLastPayQ(){
  (document.getElementById('hasLast').value === 'نعم') ? askLastPay() : finishCommit(0);
}
function askLastPay(){
  show(`<label>مبلغ الدفعة الأخيرة:</label><br>
    <input type="number" id="lastPay"><br>
    <button onclick="saveLastPay()">التالي</button>`);
}
function saveLastPay(){ finishCommit(parseFloat(document.getElementById('lastPay').value) || 0); }
function finishCommit(last){ curCommit.lastPayment = last; commitments.push({...curCommit}); curCommit = {}; askMore(); }
function askMore(){
  show(`<label>هل لديك التزامات أخرى؟</label><br>
    <select id="more"><option>نعم</option><option>لا</option></select><br>
    <button onclick="saveMore()">التالي</button>`);
}
function saveMore(){ (document.getElementById('more').value === 'نعم') ? askCommitType() : calculate(); }

function calculate(){
  const salary = answers.salary;
  const duration = answers.duration;
  const rate = answers.profitMargin;
  const financeType = answers.financeType;
  const supported = answers.supported;
  const bundle = answers.bundle;

  let deductionRate = 0, extraSupport = 0, addCommodity = false;

  const hasCar = commitments.find(c => c.type === 'قرض سيارة');
  const hasOther = commitments.find(c => c.type !== 'قرض شخصي');

  if(financeType === 'تمويل شخصي'){
    deductionRate = hasCar || hasOther ? 45 : 33.33;
    addCommodity = true;
  }else{
    deductionRate = (supported === 'مدعوم' && bundle === 'نعم') ? (salary < 15000 ? 55 : 65) : (salary < 15000 ? 55 : 65);
    if(supported === 'مدعوم' && bundle === 'نعم'){
      extraSupport = salary < 10000 ? 150000 : 100000;
    }
  }

  let allowedInstallment = salary * (deductionRate / 100);
  let personalLimit = salary * 0.3333;

  let available = allowedInstallment;
  let html = `<h2>نتيجة الحاسبة:</h2>`;

  let monthsWithCommit = 0;

  commitments.forEach(c => {
    let monthly = c.amount;
    if(financeType === 'تمويل شخصي' && c.type === 'قرض سيارة' && c.lastPayment && duration < 60){
      monthly += c.lastPayment / Math.min(24, duration);
      html += `<p><strong>تُضاف ${(c.lastPayment/Math.min(24,duration)).toFixed(0)} ريال لمدة ${Math.min(24,duration)} شهر لتغطية الدفعة الأخيرة للسيارة.</strong></p>`;
    }
    available -= monthly;
    monthsWithCommit = Math.max(monthsWithCommit, c.months);
  });

  if(available <= 0){
    show(`<h2>عذرًا</h2><p>لا يمكن تقديم تمويل حاليًا بسبب التزاماتك الحالية.</p>
    <p>للتواصل: 0506214458 - hlooleqrr.com</p>`);
    return;
  }

  const usedForPersonal = Math.min(personalLimit, available);
  const monthsAfter = duration - monthsWithCommit;
  const total1 = usedForPersonal * monthsWithCommit;
  const total2 = usedForPersonal * monthsAfter;
  const totalFinal = total1 + total2;

  const factor = (duration/12)*(rate/100)+1;
  const netFinance = totalFinal / factor;

  let fee = Math.min(netFinance * 0.01, 5000);
  let vat = Math.min(fee * 0.15, 750);
  const commodity = addCommodity ? netFinance * 0.01 : 0;
  const netAfter = netFinance - (fee + vat + commodity);
  const finalAmount = netAfter + extraSupport;

  html += `
    <p><strong>قسطك خلال أول ${monthsWithCommit} شهر:</strong> ${usedForPersonal.toFixed(0)} ريال</p>
    <p><strong>ثم القسط:</strong> ${usedForPersonal.toFixed(0)} ريال</p>
    <p><strong>إجمالي التمويل مع الأرباح:</strong> ${totalFinal.toFixed(0)} ريال</p>
    <p><strong>معامل الربح:</strong> ${factor.toFixed(3)}</p>
    <p><strong>التمويل الصافي قبل الرسوم:</strong> ${netFinance.toFixed(0)} ريال</p>
    <p><strong>الرسوم الإدارية:</strong> ${fee.toFixed(0)} ريال</p>
    <p><strong>الضريبة على الرسوم:</strong> ${vat.toFixed(0)} ريال</p>
    ${addCommodity?`<p><strong>رسوم السلع:</strong> ${commodity.toFixed(0)} ريال</p>`:''}
    <p><strong>التمويل الصافي النهائي:</strong> ${netAfter.toFixed(0)} ريال</p>
    ${extraSupport>0?`<p><strong>دعم حكومي مضاف:</strong> ${extraSupport.toLocaleString()} ريال</p>`:''}
    <h3>📞 للتواصل: 0506214458 – hlooleqrr.com</h3>`;

  show(html);
}
</script>

<footer>
  <p>جميع الحقوق محفوظة لـ سرعة تملك العقار والحلول التمويلية – <span id="datetime"></span></p>
</footer>

<script>
setInterval(()=>{
  const now = new Date();
  document.getElementById("datetime").innerText =
    now.getFullYear()+'-'+(now.getMonth()+1).toString().padStart(2,'0')+'-'+now.getDate().toString().padStart(2,'0')+
    ' '+now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0')+':'+now.getSeconds().toString().padStart(2,'0');
},1000);
</script>
</body>
</html>